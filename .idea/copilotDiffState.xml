<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/TokenHelper.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/TokenHelper.kt" />
              <option name="originalContent" value="package com.example.prm_assignment.data&#10;&#10;import android.content.Context&#10;import com.example.prm_assignment.data.model.ProfileResponse&#10;import com.example.prm_assignment.data.remote.ProfileRetrofitClient&#10;import com.example.prm_assignment.data.remote.RetrofitClient&#10;import kotlinx.coroutines.CoroutineScope&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.launch&#10;import retrofit2.Call&#10;import retrofit2.Callback&#10;import retrofit2.Response&#10;&#10;class TokenHelper(private val context: Context) {&#10;    private val tokenManager = TokenManager(context)&#10;&#10;    fun getTokenAndExecute(callback: TokenCallback) {&#10;        CoroutineScope(Dispatchers.Main).launch {&#10;            val token = tokenManager.getAccessToken()&#10;            callback.onTokenRetrieved(token)&#10;        }&#10;    }&#10;&#10;    interface TokenCallback {&#10;        fun onTokenRetrieved(token: String?)&#10;    }&#10;&#10;    // Callback for async operations&#10;    interface TokenAsyncCallback {&#10;        fun onResult(token: String?)&#10;    }&#10;&#10;    interface ClearTokensCallback {&#10;        fun onComplete()&#10;    }&#10;&#10;    interface ProfileCallback {&#10;        fun onSuccess(profile: ProfileResponse)&#10;        fun onError(message: String)&#10;    }&#10;    interface UserIdCallback {&#10;    fun getUserIdFromProfile(callback: (String?) -&gt; Unit) {&#10;        getTokenAndExecute(object : TokenCallback {&#10;            override fun onTokenRetrieved(token: String?) {&#10;                if (token.isNullOrEmpty()) {&#10;                    callback(null)&#10;                    return&#10;                }&#10;&#10;                val api = ProfileRetrofitClient.getInstance().getProfileApi()&#10;                api.getProfile(&quot;Bearer $token&quot;).enqueue(object : Callback&lt;ProfileResponse&gt; {&#10;                    override fun onResponse(&#10;                        call: Call&lt;ProfileResponse&gt;,&#10;                        response: Response&lt;ProfileResponse&gt;&#10;                    ) {&#10;                        if (response.isSuccessful &amp;&amp; response.body()?.isSuccess == true) {&#10;                            // ✅ Lấy userId chính xác&#10;                            val userId = response.body()?.data?.userId?.id&#10;                            callback(userId)&#10;                        } else {&#10;                            callback(null)&#10;                        }&#10;                    }&#10;&#10;                    override fun onFailure(call: Call&lt;ProfileResponse&gt;, t: Throwable) {&#10;                        callback(null)&#10;                    }&#10;                })&#10;            }&#10;        })&#10;    }&#10;&#10;    companion object {&#10;        @JvmStatic&#10;        suspend fun getAccessToken(context: Context): String? {&#10;            return TokenManager(context).getAccessToken()&#10;        }&#10;&#10;        @JvmStatic&#10;        suspend fun clearTokens(context: Context) {&#10;            TokenManager(context).clearTokens()&#10;        }&#10;&#10;        // Java-friendly methods that handle coroutines internally&#10;        @JvmStatic&#10;        fun getAccessTokenAsync(context: Context, callback: TokenAsyncCallback) {&#10;            CoroutineScope(Dispatchers.Main).launch {&#10;                val token = TokenManager(context).getAccessToken()&#10;                callback.onResult(token)&#10;            }&#10;        }&#10;&#10;        @JvmStatic&#10;        fun clearTokensAsync(context: Context, callback: ClearTokensCallback) {&#10;            CoroutineScope(Dispatchers.Main).launch {&#10;                TokenManager(context).clearTokens()&#10;                callback.onComplete()&#10;            }&#10;        }&#10;&#10;        @JvmStatic&#10;        fun loadProfileAsync(context: Context, callback: ProfileCallback) {&#10;            CoroutineScope(Dispatchers.Main).launch {&#10;                try {&#10;                    val token = TokenManager(context).getAccessToken()&#10;                    if (token.isNullOrEmpty()) {&#10;                        callback.onError(&quot;Token not found&quot;)&#10;                        return@launch&#10;                    }&#10;&#10;                    val response = RetrofitClient.getAuthApi().getProfile(&quot;Bearer $token&quot;)&#10;                    callback.onSuccess(response)&#10;                } catch (e: Exception) {&#10;                    callback.onError(e.message ?: &quot;Unknown error&quot;)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_assignment.data&#10;&#10;import android.content.Context&#10;import com.example.prm_assignment.data.model.ProfileResponse&#10;import com.example.prm_assignment.data.remote.ProfileRetrofitClient&#10;import com.example.prm_assignment.data.remote.RetrofitClient&#10;import kotlinx.coroutines.CoroutineScope&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.launch&#10;import retrofit2.Call&#10;import retrofit2.Callback&#10;import retrofit2.Response&#10;&#10;class TokenHelper(private val context: Context) {&#10;    private val tokenManager = TokenManager(context)&#10;&#10;    fun getTokenAndExecute(callback: TokenCallback) {&#10;        CoroutineScope(Dispatchers.Main).launch {&#10;            val token = tokenManager.getAccessToken()&#10;            callback.onTokenRetrieved(token)&#10;        }&#10;    }&#10;&#10;    interface TokenCallback {&#10;        fun onTokenRetrieved(token: String?)&#10;    }&#10;&#10;    // Callback for async operations&#10;    interface TokenAsyncCallback {&#10;        fun onResult(token: String?)&#10;    }&#10;&#10;    interface ClearTokensCallback {&#10;        fun onComplete()&#10;    }&#10;&#10;    interface ProfileCallback {&#10;        fun onSuccess(profile: ProfileResponse)&#10;        fun onError(message: String)&#10;    }&#10;    interface UserIdCallback {&#10;        fun onUserIdRetrieved(userId: String?)&#10;    }&#10;&#10;    interface CustomerIdCallback {&#10;        fun onCustomerIdRetrieved(customerId: String?)&#10;    }&#10;&#10;    //  Lấy userId (trong data.userId.id) từ API /auth/profile&#10;    fun getUserIdFromProfile(callback: (String?) -&gt; Unit) {&#10;        getTokenAndExecute(object : TokenCallback {&#10;            override fun onTokenRetrieved(token: String?) {&#10;                if (token.isNullOrEmpty()) {&#10;                    callback(null)&#10;                    return&#10;                }&#10;&#10;                val api = ProfileRetrofitClient.getInstance().getProfileApi()&#10;                api.getProfile(&quot;Bearer $token&quot;).enqueue(object : Callback&lt;ProfileResponse&gt; {&#10;                    override fun onResponse(&#10;                        call: Call&lt;ProfileResponse&gt;,&#10;                        response: Response&lt;ProfileResponse&gt;&#10;                    ) {&#10;                        if (response.isSuccessful &amp;&amp; response.body()?.isSuccess == true) {&#10;                            // ✅ Lấy userId chính xác&#10;                            val userId = response.body()?.data?.userId?.id&#10;                            callback(userId)&#10;                        } else {&#10;                            callback(null)&#10;                        }&#10;                    }&#10;&#10;                    override fun onFailure(call: Call&lt;ProfileResponse&gt;, t: Throwable) {&#10;                        callback(null)&#10;                    }&#10;                })&#10;            }&#10;        })&#10;    }&#10;&#10;    // Java-friendly version&#10;    fun getUserIdFromProfile(callback: UserIdCallback) {&#10;        getUserIdFromProfile { userId -&gt;&#10;            callback.onUserIdRetrieved(userId)&#10;        }&#10;    }&#10;&#10;    //  Lấy customerId từ userId thông qua API /customers/user/{userId}&#10;    fun getCustomerIdFromProfile(callback: CustomerIdCallback) {&#10;        getTokenAndExecute(object : TokenCallback {&#10;            override fun onTokenRetrieved(token: String?) {&#10;                if (token.isNullOrEmpty()) {&#10;                    callback.onCustomerIdRetrieved(null)&#10;                    return&#10;                }&#10;&#10;                // First get userId from profile&#10;                val authApi = ProfileRetrofitClient.getInstance().getProfileApi()&#10;                authApi.getProfile(&quot;Bearer $token&quot;).enqueue(object : Callback&lt;ProfileResponse&gt; {&#10;                    override fun onResponse(&#10;                        call: Call&lt;ProfileResponse&gt;,&#10;                        response: Response&lt;ProfileResponse&gt;&#10;                    ) {&#10;                        if (response.isSuccessful &amp;&amp; response.body()?.isSuccess == true) {&#10;                            val userId = response.body()?.data?.userId?.id&#10;                            if (userId.isNullOrEmpty()) {&#10;                                callback.onCustomerIdRetrieved(null)&#10;                                return&#10;                            }&#10;&#10;                            // Then get customerId from userId&#10;                            val customerApi = com.example.prm_assignment.data.remote.CustomerRetrofitClient.getInstance().getCustomerApi()&#10;                            customerApi.getCustomerByUserId(userId, &quot;Bearer $token&quot;).enqueue(object : Callback&lt;com.example.prm_assignment.data.model.CustomerResponse&gt; {&#10;                                override fun onResponse(&#10;                                    call: Call&lt;com.example.prm_assignment.data.model.CustomerResponse&gt;,&#10;                                    response: Response&lt;com.example.prm_assignment.data.model.CustomerResponse&gt;&#10;                                ) {&#10;                                    if (response.isSuccessful &amp;&amp; response.body()?.isSuccess == true) {&#10;                                        val customerId = response.body()?.data?.id&#10;                                        callback.onCustomerIdRetrieved(customerId)&#10;                                    } else {&#10;                                        callback.onCustomerIdRetrieved(null)&#10;                                    }&#10;                                }&#10;&#10;                                override fun onFailure(call: Call&lt;com.example.prm_assignment.data.model.CustomerResponse&gt;, t: Throwable) {&#10;                                    callback.onCustomerIdRetrieved(null)&#10;                                }&#10;                            })&#10;                        } else {&#10;                            callback.onCustomerIdRetrieved(null)&#10;                        }&#10;                    }&#10;&#10;                    override fun onFailure(call: Call&lt;ProfileResponse&gt;, t: Throwable) {&#10;                        callback.onCustomerIdRetrieved(null)&#10;                    }&#10;                })&#10;            }&#10;        })&#10;    }&#10;&#10;    companion object {&#10;        @JvmStatic&#10;        suspend fun getAccessToken(context: Context): String? {&#10;            return TokenManager(context).getAccessToken()&#10;        }&#10;&#10;        @JvmStatic&#10;        suspend fun clearTokens(context: Context) {&#10;            TokenManager(context).clearTokens()&#10;        }&#10;&#10;        // Java-friendly methods that handle coroutines internally&#10;        @JvmStatic&#10;        fun getAccessTokenAsync(context: Context, callback: TokenAsyncCallback) {&#10;            CoroutineScope(Dispatchers.Main).launch {&#10;                val token = TokenManager(context).getAccessToken()&#10;                callback.onResult(token)&#10;            }&#10;        }&#10;&#10;        @JvmStatic&#10;        fun clearTokensAsync(context: Context, callback: ClearTokensCallback) {&#10;            CoroutineScope(Dispatchers.Main).launch {&#10;                TokenManager(context).clearTokens()&#10;                callback.onComplete()&#10;            }&#10;        }&#10;&#10;        @JvmStatic&#10;        fun loadProfileAsync(context: Context, callback: ProfileCallback) {&#10;            CoroutineScope(Dispatchers.Main).launch {&#10;                try {&#10;                    val token = TokenManager(context).getAccessToken()&#10;                    if (token.isNullOrEmpty()) {&#10;                        callback.onError(&quot;Token not found&quot;)&#10;                        return@launch&#10;                    }&#10;&#10;                    val response = RetrofitClient.getAuthApi().getProfile(&quot;Bearer $token&quot;)&#10;                    callback.onSuccess(response)&#10;                } catch (e: Exception) {&#10;                    callback.onError(e.message ?: &quot;Unknown error&quot;)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/TokenManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/TokenManager.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data;&#10;&#10;import android.content.Context;&#10;import androidx.datastore.preferences.core.Preferences;&#10;import androidx.datastore.preferences.core.PreferencesKeys;&#10;import androidx.datastore.preferences.rxjava3.RxPreferenceDataStoreBuilder;&#10;import androidx.datastore.rxjava3.RxDataStore;&#10;import io.reactivex.rxjava3.core.Single;&#10;import kotlinx.coroutines.flow.Flow;&#10;import kotlinx.coroutines.flow.first;&#10;import kotlinx.coroutines.flow.map;&#10;import androidx.datastore.preferences.core.MutablePreferences;&#10;import androidx.datastore.preferences.preferencesDataStore;&#10;import kotlin.Unit;&#10;import kotlinx.coroutines.Dispatchers;&#10;import kotlinx.coroutines.CoroutineScope;&#10;import kotlinx.coroutines.flow.FlowKt;&#10;&#10;public class TokenManager {&#10;    private final Context context;&#10;    private static final String DATASTORE_NAME = &quot;auth_preferences&quot;;&#10;    private final Preferences.Key&lt;String&gt; accessTokenKey = PreferencesKeys.stringKey(&quot;access_token&quot;);&#10;    private final Preferences.Key&lt;String&gt; refreshTokenKey = PreferencesKeys.stringKey(&quot;refresh_token&quot;);&#10;&#10;    public TokenManager(Context context) {&#10;        this.context = context.getApplicationContext();&#10;    }&#10;&#10;    private androidx.datastore.core.DataStore&lt;Preferences&gt; getDataStore() {&#10;        return context.getDataStore(DATASTORE_NAME);&#10;    }&#10;&#10;    public Object saveTokens(String accessToken, String refreshToken) {&#10;        return null; // Will be implemented with coroutines&#10;    }&#10;&#10;    public Object clearTokens() {&#10;        return null; // Will be implemented with coroutines&#10;    }&#10;&#10;    public Object getAccessToken() {&#10;        return null; // Will be implemented with coroutines&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/AuthApi.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/AuthApi.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data.remote;&#10;&#10;import com.example.prm_assignment.data.model.LoginRequest;&#10;import com.example.prm_assignment.data.model.LoginResponse;&#10;import com.example.prm_assignment.data.model.ProfileResponse;&#10;import retrofit2.http.Body;&#10;import retrofit2.http.POST;&#10;import retrofit2.http.GET;&#10;import retrofit2.http.Header;&#10;&#10;public interface AuthApi {&#10;    @POST(&quot;auth/login-by-password&quot;)&#10;    Object login(@Body LoginRequest request);&#10;&#10;    @GET(&quot;auth/profile&quot;)&#10;    Object getProfile(@Header(&quot;Authorization&quot;) String token);&#10;&#10;    @POST(&quot;auth/logout&quot;)&#10;    Object logout(@Header(&quot;Authorization&quot;) String token);&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/CustomerRetrofitClient.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/CustomerRetrofitClient.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data.remote;&#10;&#10;import com.example.prm_assignment.BuildConfig;&#10;import okhttp3.OkHttpClient;&#10;import okhttp3.logging.HttpLoggingInterceptor;&#10;import retrofit2.Retrofit;&#10;import retrofit2.converter.gson.GsonConverterFactory;&#10;import java.util.concurrent.TimeUnit;&#10;&#10;public class CustomerRetrofitClient {&#10;    private static CustomerRetrofitClient instance;&#10;    private final CustomerApi customerApi;&#10;&#10;    private CustomerRetrofitClient() {&#10;        String BASE_URL = BuildConfig.BASE_URL;&#10;        if (!BASE_URL.endsWith(&quot;/&quot;)) {&#10;            BASE_URL = BASE_URL + &quot;/&quot;;&#10;        }&#10;&#10;        HttpLoggingInterceptor logging = new HttpLoggingInterceptor();&#10;        logging.setLevel(HttpLoggingInterceptor.Level.BODY);&#10;&#10;        OkHttpClient okHttpClient = new OkHttpClient.Builder()&#10;                .addInterceptor(logging)&#10;                .connectTimeout(30, TimeUnit.SECONDS)&#10;                .readTimeout(30, TimeUnit.SECONDS)&#10;                .writeTimeout(30, TimeUnit.SECONDS)&#10;                .build();&#10;&#10;        Retrofit retrofit = new Retrofit.Builder()&#10;                .baseUrl(BASE_URL)&#10;                .client(okHttpClient)&#10;                .addConverterFactory(GsonConverterFactory.create())&#10;                .build();&#10;&#10;        customerApi = retrofit.create(CustomerApi.class);&#10;    }&#10;&#10;    public static synchronized CustomerRetrofitClient getInstance() {&#10;        if (instance == null) {&#10;            instance = new CustomerRetrofitClient();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    public CustomerApi getCustomerApi() {&#10;        return customerApi;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/VehicleSubscriptionApi.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/VehicleSubscriptionApi.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data.remote;&#10;&#10;import com.example.prm_assignment.data.model.VehicleSubscriptionResponse;&#10;import retrofit2.Call;&#10;import retrofit2.http.GET;&#10;import retrofit2.http.Header;&#10;import retrofit2.http.Path;&#10;&#10;public interface VehicleSubscriptionApi {&#10;    @GET(&quot;vehicle-subscriptions/customer/{customerId}&quot;)&#10;    Call&lt;VehicleSubscriptionResponse&gt; getCustomerSubscriptions(&#10;            @Path(&quot;customerId&quot;) String customerId,&#10;            @Header(&quot;Authorization&quot;) String authHeader&#10;    );&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/VehicleSubscriptionRetrofitClient.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/VehicleSubscriptionRetrofitClient.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data.remote;&#10;&#10;import com.example.prm_assignment.BuildConfig;&#10;import okhttp3.OkHttpClient;&#10;import okhttp3.logging.HttpLoggingInterceptor;&#10;import retrofit2.Retrofit;&#10;import retrofit2.converter.gson.GsonConverterFactory;&#10;import java.util.concurrent.TimeUnit;&#10;&#10;public class VehicleSubscriptionRetrofitClient {&#10;    private static VehicleSubscriptionRetrofitClient instance;&#10;    private final VehicleSubscriptionApi vehicleSubscriptionApi;&#10;&#10;    private VehicleSubscriptionRetrofitClient() {&#10;        String BASE_URL = BuildConfig.BASE_URL;&#10;        if (!BASE_URL.endsWith(&quot;/&quot;)) {&#10;            BASE_URL = BASE_URL + &quot;/&quot;;&#10;        }&#10;&#10;        HttpLoggingInterceptor logging = new HttpLoggingInterceptor();&#10;        logging.setLevel(HttpLoggingInterceptor.Level.BODY);&#10;&#10;        OkHttpClient okHttpClient = new OkHttpClient.Builder()&#10;                .addInterceptor(logging)&#10;                .connectTimeout(30, TimeUnit.SECONDS)&#10;                .readTimeout(30, TimeUnit.SECONDS)&#10;                .writeTimeout(30, TimeUnit.SECONDS)&#10;                .build();&#10;&#10;        Retrofit retrofit = new Retrofit.Builder()&#10;                .baseUrl(BASE_URL)&#10;                .client(okHttpClient)&#10;                .addConverterFactory(GsonConverterFactory.create())&#10;                .build();&#10;&#10;        vehicleSubscriptionApi = retrofit.create(VehicleSubscriptionApi.class);&#10;    }&#10;&#10;    public static synchronized VehicleSubscriptionRetrofitClient getInstance() {&#10;        if (instance == null) {&#10;            instance = new VehicleSubscriptionRetrofitClient();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    public VehicleSubscriptionApi getVehicleSubscriptionApi() {&#10;        return vehicleSubscriptionApi;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/VehiclesFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/VehiclesFragment.java" />
              <option name="originalContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.ui.adapters.VehicleAdapter;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.VehicleModel;&#10;import com.example.prm_assignment.data.model.VehicleResponse;&#10;import com.example.prm_assignment.data.remote.VehiclesApi;&#10;import com.example.prm_assignment.data.remote.VehiclesRetrofitClient;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class VehiclesFragment extends Fragment implements VehicleAdapter.OnVehicleClickListener {&#10;&#10;    private static final String TAG = &quot;VehiclesFragment&quot;;&#10;&#10;    private RecyclerView vehiclesRecyclerView;&#10;    private VehicleAdapter vehicleAdapter;&#10;    private VehiclesApi vehiclesApi;&#10;    private TokenHelper tokenHelper;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_vehicles, container, false);&#10;&#10;        // Initialize RecyclerView&#10;        vehiclesRecyclerView = view.findViewById(R.id.vehiclesRecyclerView);&#10;        vehiclesRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));&#10;&#10;        // Initialize API client&#10;        vehiclesApi = VehiclesRetrofitClient.getInstance().getVehiclesApi();&#10;        tokenHelper = new TokenHelper(requireContext());&#10;&#10;        // Initialize adapter with empty list&#10;        vehicleAdapter = new VehicleAdapter(new ArrayList&lt;&gt;(), this);&#10;        vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;&#10;        // Fetch vehicles from API&#10;        fetchMyVehicles();&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void onVehicleClick(VehicleAdapter.Vehicle vehicle) {&#10;        // Handle vehicle click - navigate to detail fragment&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            VehicleDetailFragment detailFragment = VehicleDetailFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, detailFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBookServiceClick(VehicleAdapter.Vehicle vehicle) {&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            BookingFragment bookingFragment = BookingFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, bookingFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;&#10;    private void fetchMyVehicles() {&#10;        // Use TokenHelper to get token asynchronously&#10;        tokenHelper.getTokenAndExecute(new TokenHelper.TokenCallback() {&#10;            @Override&#10;            public void onTokenRetrieved(String token) {&#10;                if (token != null &amp;&amp; !token.isEmpty()) {&#10;                    makeApiCall(&quot;Bearer &quot; + token);&#10;                } else {&#10;                    showError(&quot;Please login first&quot;);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void makeApiCall(String authToken) {&#10;        vehiclesApi.getMyVehicles(authToken).enqueue(new Callback&lt;VehicleResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;VehicleResponse&gt; call, Response&lt;VehicleResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    VehicleResponse vehicleResponse = response.body();&#10;                    if (vehicleResponse.isSuccess() &amp;&amp; vehicleResponse.getData() != null) {&#10;                        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = convertToAdapterVehicles(vehicleResponse.getData());&#10;                        updateRecyclerView(vehicleList);&#10;                    } else {&#10;                        showError(&quot;No vehicles found&quot;);&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to fetch vehicles: &quot; + response.code());&#10;                    Log.e(TAG, &quot;Error response: &quot; + response.code() + &quot; - &quot; + response.message());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;VehicleResponse&gt; call, Throwable t) {&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;            }&#10;        });&#10;    }&#10;&#10;    private List&lt;VehicleAdapter.Vehicle&gt; convertToAdapterVehicles(List&lt;VehicleModel&gt; vehicleModels) {&#10;        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = new ArrayList&lt;&gt;();&#10;        NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(new Locale(&quot;vi&quot;, &quot;VN&quot;));&#10;&#10;        for (VehicleModel model : vehicleModels) {&#10;            String id = model.getId();&#10;            String vehicleName = model.getVehicleName() != null ? model.getVehicleName() : model.getModel();&#10;            String year = String.valueOf(model.getYear());&#10;            String vin = model.getVin();&#10;            String mileage = String.format(Locale.getDefault(), &quot;%.0f km&quot;, model.getMileage());&#10;            String price = currencyFormat.format(model.getPrice());&#10;            String owner = model.getCustomerId() != null ? model.getCustomerId().getCustomerName() : &quot;Unknown&quot;;&#10;            String address = model.getCustomerId() != null ? model.getCustomerId().getAddress() : &quot;Unknown&quot;;&#10;            String imageUrl = model.getImage(); // Get image URL from API&#10;&#10;            vehicleList.add(new VehicleAdapter.Vehicle(&#10;                    id,&#10;                    vehicleName,&#10;                    year,&#10;                    vin,&#10;                    mileage,&#10;                    price,&#10;                    owner,&#10;                    address,&#10;                    imageUrl  // Use imageUrl instead of imageResId&#10;            ));&#10;        }&#10;&#10;        return vehicleList;&#10;    }&#10;&#10;    private void updateRecyclerView(List&lt;VehicleAdapter.Vehicle&gt; vehicleList) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                vehicleAdapter = new VehicleAdapter(vehicleList, this);&#10;                vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;            });&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;            });&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.ui.adapters.VehicleAdapter;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.VehicleModel;&#10;import com.example.prm_assignment.data.model.VehicleResponse;&#10;import com.example.prm_assignment.data.remote.VehiclesApi;&#10;import com.example.prm_assignment.data.remote.VehiclesRetrofitClient;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class VehiclesFragment extends Fragment implements VehicleAdapter.OnVehicleClickListener {&#10;&#10;    private static final String TAG = &quot;VehiclesFragment&quot;;&#10;&#10;    private RecyclerView vehiclesRecyclerView;&#10;    private VehicleAdapter vehicleAdapter;&#10;    private VehiclesApi vehiclesApi;&#10;    private TokenHelper tokenHelper;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_vehicles, container, false);&#10;&#10;        // Initialize RecyclerView&#10;        vehiclesRecyclerView = view.findViewById(R.id.vehiclesRecyclerView);&#10;        vehiclesRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));&#10;&#10;        // Initialize API client&#10;        vehiclesApi = VehiclesRetrofitClient.getInstance().getVehiclesApi();&#10;        tokenHelper = new TokenHelper(requireContext());&#10;&#10;        // Initialize adapter with empty list&#10;        vehicleAdapter = new VehicleAdapter(new ArrayList&lt;&gt;(), this);&#10;        vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;&#10;        // Fetch vehicles from API&#10;        fetchMyVehicles();&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void onVehicleClick(VehicleAdapter.Vehicle vehicle) {&#10;        // Handle vehicle click - navigate to detail fragment&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            VehicleDetailFragment detailFragment = VehicleDetailFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, detailFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBookServiceClick(VehicleAdapter.Vehicle vehicle) {&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            BookingFragment bookingFragment = BookingFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, bookingFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;&#10;    private void fetchMyVehicles() {&#10;        // Use TokenHelper to get token asynchronously&#10;        tokenHelper.getTokenAndExecute(new TokenHelper.TokenCallback() {&#10;            @Override&#10;            public void onTokenRetrieved(String token) {&#10;                if (token != null &amp;&amp; !token.isEmpty()) {&#10;                    makeApiCall(&quot;Bearer &quot; + token);&#10;                } else {&#10;                    showError(&quot;Please login first&quot;);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void makeApiCall(String authToken) {&#10;        vehiclesApi.getMyVehicles(authToken).enqueue(new Callback&lt;VehicleResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;VehicleResponse&gt; call, Response&lt;VehicleResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    VehicleResponse vehicleResponse = response.body();&#10;                    if (vehicleResponse.isSuccess() &amp;&amp; vehicleResponse.getData() != null) {&#10;                        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = convertToAdapterVehicles(vehicleResponse.getData());&#10;                        updateRecyclerView(vehicleList);&#10;                    } else {&#10;                        showError(&quot;No vehicles found&quot;);&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to fetch vehicles: &quot; + response.code());&#10;                    Log.e(TAG, &quot;Error response: &quot; + response.code() + &quot; - &quot; + response.message());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;VehicleResponse&gt; call, Throwable t) {&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;            }&#10;        });&#10;    }&#10;&#10;    private List&lt;VehicleAdapter.Vehicle&gt; convertToAdapterVehicles(List&lt;VehicleModel&gt; vehicleModels) {&#10;        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = new ArrayList&lt;&gt;();&#10;        NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(new Locale(&quot;vi&quot;, &quot;VN&quot;));&#10;&#10;        for (VehicleModel model : vehicleModels) {&#10;            String id = model.getId();&#10;            String vehicleName = model.getVehicleName() != null ? model.getVehicleName() : model.getModel();&#10;            String year = String.valueOf(model.getYear());&#10;            String vin = model.getVin();&#10;            String mileage = String.format(Locale.getDefault(), &quot;%.0f km&quot;, model.getMileage());&#10;            String price = currencyFormat.format(model.getPrice());&#10;            String owner = model.getCustomerId() != null ? model.getCustomerId().getCustomerName() : &quot;Unknown&quot;;&#10;            String address = model.getCustomerId() != null ? model.getCustomerId().getAddress() : &quot;Unknown&quot;;&#10;            String imageUrl = model.getImage(); // Get image URL from API&#10;&#10;            vehicleList.add(new VehicleAdapter.Vehicle(&#10;                    id,&#10;                    vehicleName,&#10;                    year,&#10;                    vin,&#10;                    mileage,&#10;                    price,&#10;                    owner,&#10;                    address,&#10;                    imageUrl  // Use imageUrl instead of imageResId&#10;            ));&#10;        }&#10;&#10;        return vehicleList;&#10;    }&#10;&#10;    private void updateRecyclerView(List&lt;VehicleAdapter.Vehicle&gt; vehicleList) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                vehicleAdapter = new VehicleAdapter(vehicleList, this);&#10;                vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;            });&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;            });&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>