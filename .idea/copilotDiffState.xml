<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/VehiclesFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/VehiclesFragment.java" />
              <option name="originalContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.ui.adapters.VehicleAdapter;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.VehicleModel;&#10;import com.example.prm_assignment.data.model.VehicleResponse;&#10;import com.example.prm_assignment.data.remote.VehiclesApi;&#10;import com.example.prm_assignment.data.remote.VehiclesRetrofitClient;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class VehiclesFragment extends Fragment implements VehicleAdapter.OnVehicleClickListener {&#10;&#10;    private static final String TAG = &quot;VehiclesFragment&quot;;&#10;&#10;    private RecyclerView vehiclesRecyclerView;&#10;    private VehicleAdapter vehicleAdapter;&#10;    private VehiclesApi vehiclesApi;&#10;    private TokenHelper tokenHelper;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_vehicles, container, false);&#10;&#10;        // Initialize RecyclerView&#10;        vehiclesRecyclerView = view.findViewById(R.id.vehiclesRecyclerView);&#10;        vehiclesRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));&#10;&#10;        // Initialize API client&#10;        vehiclesApi = VehiclesRetrofitClient.getInstance().getVehiclesApi();&#10;        tokenHelper = new TokenHelper(requireContext());&#10;&#10;        // Initialize adapter with empty list&#10;        vehicleAdapter = new VehicleAdapter(new ArrayList&lt;&gt;(), this);&#10;        vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;&#10;        // Fetch vehicles from API&#10;        fetchMyVehicles();&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void onVehicleClick(VehicleAdapter.Vehicle vehicle) {&#10;        // Handle vehicle click - navigate to detail fragment&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            VehicleDetailFragment detailFragment = VehicleDetailFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, detailFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBookServiceClick(VehicleAdapter.Vehicle vehicle) {&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            BookingFragment bookingFragment = BookingFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, bookingFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;&#10;    private void fetchMyVehicles() {&#10;        // Use TokenHelper to get token asynchronously&#10;        tokenHelper.getTokenAndExecute(new TokenHelper.TokenCallback() {&#10;            @Override&#10;            public void onTokenRetrieved(String token) {&#10;                if (token != null &amp;&amp; !token.isEmpty()) {&#10;                    makeApiCall(&quot;Bearer &quot; + token);&#10;                } else {&#10;                    showError(&quot;Please login first&quot;);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void makeApiCall(String authToken) {&#10;        vehiclesApi.getMyVehicles(authToken).enqueue(new Callback&lt;VehicleResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;VehicleResponse&gt; call, Response&lt;VehicleResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    VehicleResponse vehicleResponse = response.body();&#10;                    if (vehicleResponse.isSuccess() &amp;&amp; vehicleResponse.getData() != null) {&#10;                        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = convertToAdapterVehicles(vehicleResponse.getData());&#10;                        updateRecyclerView(vehicleList);&#10;                    } else {&#10;                        showError(&quot;No vehicles found&quot;);&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to fetch vehicles: &quot; + response.code());&#10;                    Log.e(TAG, &quot;Error response: &quot; + response.code() + &quot; - &quot; + response.message());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;VehicleResponse&gt; call, Throwable t) {&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;            }&#10;        });&#10;    }&#10;&#10;    private List&lt;VehicleAdapter.Vehicle&gt; convertToAdapterVehicles(List&lt;VehicleModel&gt; vehicleModels) {&#10;        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = new ArrayList&lt;&gt;();&#10;        NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(new Locale(&quot;vi&quot;, &quot;VN&quot;));&#10;&#10;        for (VehicleModel model : vehicleModels) {&#10;            String id = model.getId();&#10;            String vehicleName = model.getVehicleName() != null ? model.getVehicleName() : model.getModel();&#10;            String year = String.valueOf(model.getYear());&#10;            String vin = model.getVin();&#10;            String mileage = String.format(Locale.getDefault(), &quot;%.0f km&quot;, model.getMileage());&#10;            String price = currencyFormat.format(model.getPrice());&#10;            String owner = model.getCustomerId() != null ? model.getCustomerId().getCustomerName() : &quot;Unknown&quot;;&#10;            String address = model.getCustomerId() != null ? model.getCustomerId().getAddress() : &quot;Unknown&quot;;&#10;            String imageUrl = model.getImage(); // Get image URL from API&#10;&#10;            vehicleList.add(new VehicleAdapter.Vehicle(&#10;                    id,&#10;                    vehicleName,&#10;                    year,&#10;                    vin,&#10;                    mileage,&#10;                    price,&#10;                    owner,&#10;                    address,&#10;                    imageUrl  // Use imageUrl instead of imageResId&#10;            ));&#10;        }&#10;&#10;        return vehicleList;&#10;    }&#10;&#10;    private void updateRecyclerView(List&lt;VehicleAdapter.Vehicle&gt; vehicleList) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                vehicleAdapter = new VehicleAdapter(vehicleList, this);&#10;                vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;            });&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;            });&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.ui.adapters.VehicleAdapter;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.VehicleModel;&#10;import com.example.prm_assignment.data.model.VehicleResponse;&#10;import com.example.prm_assignment.data.remote.VehiclesApi;&#10;import com.example.prm_assignment.data.remote.VehiclesRetrofitClient;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class VehiclesFragment extends Fragment implements VehicleAdapter.OnVehicleClickListener {&#10;&#10;    private static final String TAG = &quot;VehiclesFragment&quot;;&#10;&#10;    private RecyclerView vehiclesRecyclerView;&#10;    private VehicleAdapter vehicleAdapter;&#10;    private VehiclesApi vehiclesApi;&#10;    private TokenHelper tokenHelper;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_vehicles, container, false);&#10;&#10;        // Initialize RecyclerView&#10;        vehiclesRecyclerView = view.findViewById(R.id.vehiclesRecyclerView);&#10;        vehiclesRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));&#10;&#10;        // Initialize API client&#10;        vehiclesApi = VehiclesRetrofitClient.getInstance().getVehiclesApi();&#10;        tokenHelper = new TokenHelper(requireContext());&#10;&#10;        // Initialize adapter with empty list&#10;        vehicleAdapter = new VehicleAdapter(new ArrayList&lt;&gt;(), this);&#10;        vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;&#10;        // Fetch vehicles from API&#10;        fetchMyVehicles();&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void onVehicleClick(VehicleAdapter.Vehicle vehicle) {&#10;        // Handle vehicle click - navigate to detail fragment&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            VehicleDetailFragment detailFragment = VehicleDetailFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, detailFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBookServiceClick(VehicleAdapter.Vehicle vehicle) {&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            BookingFragment bookingFragment = BookingFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, bookingFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;&#10;    private void fetchMyVehicles() {&#10;        // Use TokenHelper to get token asynchronously&#10;        tokenHelper.getTokenAndExecute(new TokenHelper.TokenCallback() {&#10;            @Override&#10;            public void onTokenRetrieved(String token) {&#10;                if (token != null &amp;&amp; !token.isEmpty()) {&#10;                    makeApiCall(&quot;Bearer &quot; + token);&#10;                } else {&#10;                    showError(&quot;Please login first&quot;);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void makeApiCall(String authToken) {&#10;        vehiclesApi.getMyVehicles(authToken).enqueue(new Callback&lt;VehicleResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;VehicleResponse&gt; call, Response&lt;VehicleResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    VehicleResponse vehicleResponse = response.body();&#10;                    if (vehicleResponse.isSuccess() &amp;&amp; vehicleResponse.getData() != null) {&#10;                        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = convertToAdapterVehicles(vehicleResponse.getData());&#10;                        updateRecyclerView(vehicleList);&#10;                    } else {&#10;                        showError(&quot;No vehicles found&quot;);&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to fetch vehicles: &quot; + response.code());&#10;                    Log.e(TAG, &quot;Error response: &quot; + response.code() + &quot; - &quot; + response.message());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;VehicleResponse&gt; call, Throwable t) {&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;            }&#10;        });&#10;    }&#10;&#10;    private List&lt;VehicleAdapter.Vehicle&gt; convertToAdapterVehicles(List&lt;VehicleModel&gt; vehicleModels) {&#10;        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = new ArrayList&lt;&gt;();&#10;        NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(new Locale(&quot;vi&quot;, &quot;VN&quot;));&#10;&#10;        for (VehicleModel model : vehicleModels) {&#10;            String id = model.getId();&#10;            String vehicleName = model.getVehicleName() != null ? model.getVehicleName() : model.getModel();&#10;            String year = String.valueOf(model.getYear());&#10;            String vin = model.getVin();&#10;            String mileage = String.format(Locale.getDefault(), &quot;%.0f km&quot;, model.getMileage());&#10;            String price = currencyFormat.format(model.getPrice());&#10;            String owner = model.getCustomerId() != null ? model.getCustomerId().getCustomerName() : &quot;Unknown&quot;;&#10;            String address = model.getCustomerId() != null ? model.getCustomerId().getAddress() : &quot;Unknown&quot;;&#10;            String imageUrl = model.getImage(); // Get image URL from API&#10;&#10;            vehicleList.add(new VehicleAdapter.Vehicle(&#10;                    id,&#10;                    vehicleName,&#10;                    year,&#10;                    vin,&#10;                    mileage,&#10;                    price,&#10;                    owner,&#10;                    address,&#10;                    imageUrl  // Use imageUrl instead of imageResId&#10;            ));&#10;        }&#10;&#10;        return vehicleList;&#10;    }&#10;&#10;    private void updateRecyclerView(List&lt;VehicleAdapter.Vehicle&gt; vehicleList) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                vehicleAdapter = new VehicleAdapter(vehicleList, this);&#10;                vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;            });&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;            });&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>