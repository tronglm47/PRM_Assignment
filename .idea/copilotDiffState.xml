<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/TokenManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/TokenManager.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data;&#10;&#10;import android.content.Context;&#10;import androidx.datastore.preferences.core.Preferences;&#10;import androidx.datastore.preferences.core.PreferencesKeys;&#10;import androidx.datastore.preferences.rxjava3.RxPreferenceDataStoreBuilder;&#10;import androidx.datastore.rxjava3.RxDataStore;&#10;import io.reactivex.rxjava3.core.Single;&#10;import kotlinx.coroutines.flow.Flow;&#10;import kotlinx.coroutines.flow.first;&#10;import kotlinx.coroutines.flow.map;&#10;import androidx.datastore.preferences.core.MutablePreferences;&#10;import androidx.datastore.preferences.preferencesDataStore;&#10;import kotlin.Unit;&#10;import kotlinx.coroutines.Dispatchers;&#10;import kotlinx.coroutines.CoroutineScope;&#10;import kotlinx.coroutines.flow.FlowKt;&#10;&#10;public class TokenManager {&#10;    private final Context context;&#10;    private static final String DATASTORE_NAME = &quot;auth_preferences&quot;;&#10;    private final Preferences.Key&lt;String&gt; accessTokenKey = PreferencesKeys.stringKey(&quot;access_token&quot;);&#10;    private final Preferences.Key&lt;String&gt; refreshTokenKey = PreferencesKeys.stringKey(&quot;refresh_token&quot;);&#10;&#10;    public TokenManager(Context context) {&#10;        this.context = context.getApplicationContext();&#10;    }&#10;&#10;    private androidx.datastore.core.DataStore&lt;Preferences&gt; getDataStore() {&#10;        return context.getDataStore(DATASTORE_NAME);&#10;    }&#10;&#10;    public Object saveTokens(String accessToken, String refreshToken) {&#10;        return null; // Will be implemented with coroutines&#10;    }&#10;&#10;    public Object clearTokens() {&#10;        return null; // Will be implemented with coroutines&#10;    }&#10;&#10;    public Object getAccessToken() {&#10;        return null; // Will be implemented with coroutines&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/model/LoginRequest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/model/LoginRequest.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data.model;&#10;&#10;public class LoginRequest {&#10;    private String identifier;&#10;    private String password;&#10;&#10;    public LoginRequest() {&#10;    }&#10;&#10;    public LoginRequest(String identifier, String password) {&#10;        this.identifier = identifier;&#10;        this.password = password;&#10;    }&#10;&#10;    public String getIdentifier() {&#10;        return identifier;&#10;    }&#10;&#10;    public void setIdentifier(String identifier) {&#10;        this.identifier = identifier;&#10;    }&#10;&#10;    public String getPassword() {&#10;        return password;&#10;    }&#10;&#10;    public void setPassword(String password) {&#10;        this.password = password;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/model/LoginResponse.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/model/LoginResponse.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data.model;&#10;&#10;public class LoginResponse {&#10;    private boolean success;&#10;    private String message;&#10;    private LoginData data;&#10;&#10;    public LoginResponse() {&#10;    }&#10;&#10;    public LoginResponse(boolean success, String message, LoginData data) {&#10;        this.success = success;&#10;        this.message = message;&#10;        this.data = data;&#10;    }&#10;&#10;    public boolean isSuccess() {&#10;        return success;&#10;    }&#10;&#10;    public void setSuccess(boolean success) {&#10;        this.success = success;&#10;    }&#10;&#10;    public String getMessage() {&#10;        return message;&#10;    }&#10;&#10;    public void setMessage(String message) {&#10;        this.message = message;&#10;    }&#10;&#10;    public LoginData getData() {&#10;        return data;&#10;    }&#10;&#10;    public void setData(LoginData data) {&#10;        this.data = data;&#10;    }&#10;&#10;    public static class LoginData {&#10;        private String accessToken;&#10;        private String refreshToken;&#10;        private UserInfo user;&#10;&#10;        public LoginData() {&#10;        }&#10;&#10;        public LoginData(String accessToken, String refreshToken, UserInfo user) {&#10;            this.accessToken = accessToken;&#10;            this.refreshToken = refreshToken;&#10;            this.user = user;&#10;        }&#10;&#10;        public String getAccessToken() {&#10;            return accessToken;&#10;        }&#10;&#10;        public void setAccessToken(String accessToken) {&#10;            this.accessToken = accessToken;&#10;        }&#10;&#10;        public String getRefreshToken() {&#10;            return refreshToken;&#10;        }&#10;&#10;        public void setRefreshToken(String refreshToken) {&#10;            this.refreshToken = refreshToken;&#10;        }&#10;&#10;        public UserInfo getUser() {&#10;            return user;&#10;        }&#10;&#10;        public void setUser(UserInfo user) {&#10;            this.user = user;&#10;        }&#10;    }&#10;&#10;    public static class UserInfo {&#10;        private String id;&#10;        private String email;&#10;        private String fullName;&#10;        private String phoneNumber;&#10;        private String avatar;&#10;&#10;        public UserInfo() {&#10;        }&#10;&#10;        public UserInfo(String id, String email, String fullName, String phoneNumber, String avatar) {&#10;            this.id = id;&#10;            this.email = email;&#10;            this.fullName = fullName;&#10;            this.phoneNumber = phoneNumber;&#10;            this.avatar = avatar;&#10;        }&#10;&#10;        public String getId() {&#10;            return id;&#10;        }&#10;&#10;        public void setId(String id) {&#10;            this.id = id;&#10;        }&#10;&#10;        public String getEmail() {&#10;            return email;&#10;        }&#10;&#10;        public void setEmail(String email) {&#10;            this.email = email;&#10;        }&#10;&#10;        public String getFullName() {&#10;            return fullName;&#10;        }&#10;&#10;        public void setFullName(String fullName) {&#10;            this.fullName = fullName;&#10;        }&#10;&#10;        public String getPhoneNumber() {&#10;            return phoneNumber;&#10;        }&#10;&#10;        public void setPhoneNumber(String phoneNumber) {&#10;            this.phoneNumber = phoneNumber;&#10;        }&#10;&#10;        public String getAvatar() {&#10;            return avatar;&#10;        }&#10;&#10;        public void setAvatar(String avatar) {&#10;            this.avatar = avatar;&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/model/ProfileResponse.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/model/ProfileResponse.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data.model;&#10;&#10;import com.google.gson.annotations.SerializedName;&#10;import java.util.List;&#10;&#10;public class ProfileResponse {&#10;    private boolean success;&#10;    private String message;&#10;    private ProfileData data;&#10;&#10;    public ProfileResponse() {&#10;    }&#10;&#10;    public ProfileResponse(boolean success, String message, ProfileData data) {&#10;        this.success = success;&#10;        this.message = message;&#10;        this.data = data;&#10;    }&#10;&#10;    public boolean isSuccess() {&#10;        return success;&#10;    }&#10;&#10;    public void setSuccess(boolean success) {&#10;        this.success = success;&#10;    }&#10;&#10;    public String getMessage() {&#10;        return message;&#10;    }&#10;&#10;    public void setMessage(String message) {&#10;        this.message = message;&#10;    }&#10;&#10;    public ProfileData getData() {&#10;        return data;&#10;    }&#10;&#10;    public void setData(ProfileData data) {&#10;        this.data = data;&#10;    }&#10;&#10;    public static class ProfileData {&#10;        @SerializedName(&quot;_id&quot;)&#10;        private String id;&#10;        private UserId userId;&#10;        private String customerName;&#10;        private String address;&#10;        private String dateOfBirth;&#10;        private List&lt;String&gt; deviceTokens;&#10;        private String createdAt;&#10;        private String updatedAt;&#10;&#10;        public ProfileData() {&#10;        }&#10;&#10;        public ProfileData(String id, UserId userId, String customerName, String address, &#10;                          String dateOfBirth, List&lt;String&gt; deviceTokens, String createdAt, String updatedAt) {&#10;            this.id = id;&#10;            this.userId = userId;&#10;            this.customerName = customerName;&#10;            this.address = address;&#10;            this.dateOfBirth = dateOfBirth;&#10;            this.deviceTokens = deviceTokens;&#10;            this.createdAt = createdAt;&#10;            this.updatedAt = updatedAt;&#10;        }&#10;&#10;        public String getId() {&#10;            return id;&#10;        }&#10;&#10;        public void setId(String id) {&#10;            this.id = id;&#10;        }&#10;&#10;        public UserId getUserId() {&#10;            return userId;&#10;        }&#10;&#10;        public void setUserId(UserId userId) {&#10;            this.userId = userId;&#10;        }&#10;&#10;        public String getCustomerName() {&#10;            return customerName;&#10;        }&#10;&#10;        public void setCustomerName(String customerName) {&#10;            this.customerName = customerName;&#10;        }&#10;&#10;        public String getAddress() {&#10;            return address;&#10;        }&#10;&#10;        public void setAddress(String address) {&#10;            this.address = address;&#10;        }&#10;&#10;        public String getDateOfBirth() {&#10;            return dateOfBirth;&#10;        }&#10;&#10;        public void setDateOfBirth(String dateOfBirth) {&#10;            this.dateOfBirth = dateOfBirth;&#10;        }&#10;&#10;        public List&lt;String&gt; getDeviceTokens() {&#10;            return deviceTokens;&#10;        }&#10;&#10;        public void setDeviceTokens(List&lt;String&gt; deviceTokens) {&#10;            this.deviceTokens = deviceTokens;&#10;        }&#10;&#10;        public String getCreatedAt() {&#10;            return createdAt;&#10;        }&#10;&#10;        public void setCreatedAt(String createdAt) {&#10;            this.createdAt = createdAt;&#10;        }&#10;&#10;        public String getUpdatedAt() {&#10;            return updatedAt;&#10;        }&#10;&#10;        public void setUpdatedAt(String updatedAt) {&#10;            this.updatedAt = updatedAt;&#10;        }&#10;    }&#10;&#10;    public static class UserId {&#10;        @SerializedName(&quot;_id&quot;)&#10;        private String id;&#10;        private String phone;&#10;        private String role;&#10;        private String email;&#10;&#10;        public UserId() {&#10;        }&#10;&#10;        public UserId(String id, String phone, String role, String email) {&#10;            this.id = id;&#10;            this.phone = phone;&#10;            this.role = role;&#10;            this.email = email;&#10;        }&#10;&#10;        public String getId() {&#10;            return id;&#10;        }&#10;&#10;        public void setId(String id) {&#10;            this.id = id;&#10;        }&#10;&#10;        public String getPhone() {&#10;            return phone;&#10;        }&#10;&#10;        public void setPhone(String phone) {&#10;            this.phone = phone;&#10;        }&#10;&#10;        public String getRole() {&#10;            return role;&#10;        }&#10;&#10;        public void setRole(String role) {&#10;            this.role = role;&#10;        }&#10;&#10;        public String getEmail() {&#10;            return email;&#10;        }&#10;&#10;        public void setEmail(String email) {&#10;            this.email = email;&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/AuthApi.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/data/remote/AuthApi.java" />
              <option name="updatedContent" value="package com.example.prm_assignment.data.remote;&#10;&#10;import com.example.prm_assignment.data.model.LoginRequest;&#10;import com.example.prm_assignment.data.model.LoginResponse;&#10;import com.example.prm_assignment.data.model.ProfileResponse;&#10;import retrofit2.http.Body;&#10;import retrofit2.http.POST;&#10;import retrofit2.http.GET;&#10;import retrofit2.http.Header;&#10;&#10;public interface AuthApi {&#10;    @POST(&quot;auth/login-by-password&quot;)&#10;    Object login(@Body LoginRequest request);&#10;&#10;    @GET(&quot;auth/profile&quot;)&#10;    Object getProfile(@Header(&quot;Authorization&quot;) String token);&#10;&#10;    @POST(&quot;auth/logout&quot;)&#10;    Object logout(@Header(&quot;Authorization&quot;) String token);&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/AuthViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/AuthViewModel.kt" />
              <option name="originalContent" value="package com.example.prm_assignment.ui&#10;&#10;import android.app.Application&#10;import android.util.Log&#10;import androidx.lifecycle.AndroidViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.prm_assignment.data.TokenManager&#10;import com.example.prm_assignment.data.model.LoginRequest&#10;import com.example.prm_assignment.data.model.ProfileData&#10;import com.example.prm_assignment.data.remote.RetrofitClient&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;data class AuthState(&#10;    val isLoading: Boolean = false,&#10;    val isLoggedIn: Boolean = false,&#10;    val userProfile: ProfileData? = null,&#10;    val errorMessage: String? = null,&#10;    val successMessage: String? = null&#10;)&#10;&#10;class AuthViewModel(application: Application) : AndroidViewModel(application) {&#10;    private val tokenManager = TokenManager(application.applicationContext)&#10;    private val authApi = RetrofitClient.getAuthApi()&#10;&#10;    private val _authState = MutableStateFlow(AuthState())&#10;    val authState: StateFlow&lt;AuthState&gt; = _authState.asStateFlow()&#10;&#10;    companion object {&#10;        private const val TAG = &quot;AuthViewModel&quot;&#10;    }&#10;&#10;    fun login(email: String, password: String) {&#10;        viewModelScope.launch {&#10;            try {&#10;                Log.d(TAG, &quot;Starting login for email: $email&quot;)&#10;                _authState.value = _authState.value.copy(isLoading = true, errorMessage = null)&#10;&#10;                val request = LoginRequest(&#10;                    identifier = email,&#10;                    password = password&#10;                )&#10;&#10;                Log.d(TAG, &quot;Calling login API...&quot;)&#10;                val response = authApi.login(request)&#10;                Log.d(TAG, &quot;Login API response: success=${response.success}, message=${response.message}&quot;)&#10;&#10;                if (response.success &amp;&amp; response.data != null) {&#10;                    // Lưu token&#10;                    Log.d(TAG, &quot;Saving tokens...&quot;)&#10;                    tokenManager.saveTokens(response.data.accessToken, response.data.refreshToken)&#10;                    Log.d(TAG, &quot;Tokens saved successfully&quot;)&#10;&#10;                    // Lấy thông tin user trước khi set isLoggedIn = true&#10;                    try {&#10;                        Log.d(TAG, &quot;Fetching user profile...&quot;)&#10;                        val profileResponse = authApi.getProfile(&quot;Bearer ${response.data.accessToken}&quot;)&#10;                        Log.d(TAG, &quot;Profile API response: success=${profileResponse.success}&quot;)&#10;&#10;                        val userProfile = if (profileResponse.success &amp;&amp; profileResponse.data != null) {&#10;                            Log.d(TAG, &quot;User profile: ${profileResponse.data}&quot;)&#10;                            profileResponse.data&#10;                        } else {&#10;                            Log.w(TAG, &quot;Profile response failed or data is null&quot;)&#10;                            null&#10;                        }&#10;&#10;                        // Chỉ set isLoggedIn = true sau khi đã có thông tin user&#10;                        Log.d(TAG, &quot;Setting isLoggedIn = true&quot;)&#10;                        _authState.value = _authState.value.copy(&#10;                            isLoggedIn = true,&#10;                            isLoading = false,&#10;                            userProfile = userProfile,&#10;                            successMessage = &quot;Đăng nhập thành công!&quot;&#10;                        )&#10;                        Log.d(TAG, &quot;Login completed successfully&quot;)&#10;                    } catch (profileException: Exception) {&#10;                        Log.e(TAG, &quot;Error fetching profile&quot;, profileException)&#10;                        // Vẫn cho đăng nhập thành công nhưng không có profile&#10;                        _authState.value = _authState.value.copy(&#10;                            isLoggedIn = true,&#10;                            isLoading = false,&#10;                            userProfile = null,&#10;                            successMessage = &quot;Đăng nhập thành công!&quot;&#10;                        )&#10;                    }&#10;                } else {&#10;                    Log.w(TAG, &quot;Login failed: ${response.message}&quot;)&#10;                    _authState.value = _authState.value.copy(&#10;                        isLoading = false,&#10;                        errorMessage = response.message ?: &quot;Đăng nhập thất bại&quot;&#10;                    )&#10;                }&#10;            } catch (e: java.net.ConnectException) {&#10;                Log.e(TAG, &quot;Connection exception&quot;, e)&#10;                _authState.value = _authState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Không thể kết nối đến server. Vui lòng kiểm tra:\n1. Backend đã chạy chưa?\n2. Port đúng chưa? (hiện tại: 8080)&quot;&#10;                )&#10;            } catch (e: java.net.SocketTimeoutException) {&#10;                Log.e(TAG, &quot;Socket timeout exception&quot;, e)&#10;                _authState.value = _authState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Kết nối timeout. Server không phản hồi.&quot;&#10;                )&#10;            } catch (e: Exception) {&#10;                Log.e(TAG, &quot;Unexpected exception during login&quot;, e)&#10;                _authState.value = _authState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Lỗi: ${e.localizedMessage ?: e.message}\n${e.stackTraceToString()}&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    private suspend fun fetchUserProfile(token: String) {&#10;        try {&#10;            val response = authApi.getProfile(token)&#10;            if (response.success &amp;&amp; response.data != null) {&#10;                _authState.value = _authState.value.copy(&#10;                    userProfile = response.data&#10;                )&#10;            }&#10;        } catch (e: Exception) {&#10;            // Xử lý lỗi lấy profile&#10;        }&#10;    }&#10;&#10;    fun logout() {&#10;        viewModelScope.launch {&#10;            try {&#10;                _authState.value = _authState.value.copy(isLoading = true)&#10;&#10;                val token = tokenManager.getAccessToken()&#10;                if (token != null) {&#10;                    authApi.logout(&quot;Bearer $token&quot;)&#10;                }&#10;&#10;                tokenManager.clearTokens()&#10;                _authState.value = AuthState(successMessage = &quot;Đã đăng xuất&quot;)&#10;            } catch (e: Exception) {&#10;                _authState.value = _authState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Lỗi đăng xuất: ${e.message}&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    fun loadUserProfile() {&#10;        viewModelScope.launch {&#10;            val token = tokenManager.getAccessToken()&#10;            if (token != null) {&#10;                fetchUserProfile(&quot;Bearer $token&quot;)&#10;            }&#10;        }&#10;    }&#10;&#10;    fun clearMessages() {&#10;        _authState.value = _authState.value.copy(errorMessage = null, successMessage = null)&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_assignment.ui&#10;&#10;import android.app.Application&#10;import android.util.Log&#10;import androidx.lifecycle.AndroidViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.prm_assignment.data.TokenManager&#10;import com.example.prm_assignment.data.model.LoginRequest&#10;import com.example.prm_assignment.data.model.ProfileResponse&#10;import com.example.prm_assignment.data.remote.RetrofitClient&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;data class AuthState(&#10;    val isLoading: Boolean = false,&#10;    val isLoggedIn: Boolean = false,&#10;    val userProfile: ProfileResponse.ProfileData? = null,&#10;    val errorMessage: String? = null,&#10;    val successMessage: String? = null&#10;)&#10;&#10;class AuthViewModel(application: Application) : AndroidViewModel(application) {&#10;    private val tokenManager = TokenManager(application.applicationContext)&#10;    private val authApi = RetrofitClient.getAuthApi()&#10;&#10;    private val _authState = MutableStateFlow(AuthState())&#10;    val authState: StateFlow&lt;AuthState&gt; = _authState.asStateFlow()&#10;&#10;    companion object {&#10;        private const val TAG = &quot;AuthViewModel&quot;&#10;    }&#10;&#10;    fun login(email: String, password: String) {&#10;        viewModelScope.launch {&#10;            try {&#10;                Log.d(TAG, &quot;Starting login for email: $email&quot;)&#10;                _authState.value = _authState.value.copy(isLoading = true, errorMessage = null)&#10;&#10;                val request = LoginRequest(email, password)&#10;&#10;                Log.d(TAG, &quot;Calling login API...&quot;)&#10;                val response = authApi.login(request)&#10;                Log.d(TAG, &quot;Login API response: success=${response.isSuccess}, message=${response.message}&quot;)&#10;&#10;                if (response.isSuccess &amp;&amp; response.data != null) {&#10;                    // Lưu token&#10;                    Log.d(TAG, &quot;Saving tokens...&quot;)&#10;                    tokenManager.saveTokens(response.data.accessToken, response.data.refreshToken)&#10;                    Log.d(TAG, &quot;Tokens saved successfully&quot;)&#10;&#10;                    // Lấy thông tin user trước khi set isLoggedIn = true&#10;                    try {&#10;                        Log.d(TAG, &quot;Fetching user profile...&quot;)&#10;                        val profileResponse = authApi.getProfile(&quot;Bearer ${response.data.accessToken}&quot;)&#10;                        Log.d(TAG, &quot;Profile API response: success=${profileResponse.isSuccess}&quot;)&#10;&#10;                        val userProfile = if (profileResponse.isSuccess &amp;&amp; profileResponse.data != null) {&#10;                            Log.d(TAG, &quot;User profile: ${profileResponse.data}&quot;)&#10;                            profileResponse.data&#10;                        } else {&#10;                            Log.w(TAG, &quot;Profile response failed or data is null&quot;)&#10;                            null&#10;                        }&#10;&#10;                        // Chỉ set isLoggedIn = true sau khi đã có thông tin user&#10;                        Log.d(TAG, &quot;Setting isLoggedIn = true&quot;)&#10;                        _authState.value = _authState.value.copy(&#10;                            isLoggedIn = true,&#10;                            isLoading = false,&#10;                            userProfile = userProfile,&#10;                            successMessage = &quot;Đăng nhập thành công!&quot;&#10;                        )&#10;                        Log.d(TAG, &quot;Login completed successfully&quot;)&#10;                    } catch (profileException: Exception) {&#10;                        Log.e(TAG, &quot;Error fetching profile&quot;, profileException)&#10;                        // Vẫn cho đăng nhập thành công nhưng không có profile&#10;                        _authState.value = _authState.value.copy(&#10;                            isLoggedIn = true,&#10;                            isLoading = false,&#10;                            userProfile = null,&#10;                            successMessage = &quot;Đăng nhập thành công!&quot;&#10;                        )&#10;                    }&#10;                } else {&#10;                    Log.w(TAG, &quot;Login failed: ${response.message}&quot;)&#10;                    _authState.value = _authState.value.copy(&#10;                        isLoading = false,&#10;                        errorMessage = response.message ?: &quot;Đăng nhập thất bại&quot;&#10;                    )&#10;                }&#10;            } catch (e: java.net.ConnectException) {&#10;                Log.e(TAG, &quot;Connection exception&quot;, e)&#10;                _authState.value = _authState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Không thể kết nối đến server. Vui lòng kiểm tra:\n1. Backend đã chạy chưa?\n2. Port đúng chưa? (hiện tại: 8080)&quot;&#10;                )&#10;            } catch (e: java.net.SocketTimeoutException) {&#10;                Log.e(TAG, &quot;Socket timeout exception&quot;, e)&#10;                _authState.value = _authState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Kết nối timeout. Server không phản hồi.&quot;&#10;                )&#10;            } catch (e: Exception) {&#10;                Log.e(TAG, &quot;Unexpected exception during login&quot;, e)&#10;                _authState.value = _authState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Lỗi: ${e.localizedMessage ?: e.message}\n${e.stackTraceToString()}&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    private suspend fun fetchUserProfile(token: String) {&#10;        try {&#10;            val response = authApi.getProfile(token)&#10;            if (response.isSuccess &amp;&amp; response.data != null) {&#10;                _authState.value = _authState.value.copy(&#10;                    userProfile = response.data&#10;                )&#10;            }&#10;        } catch (e: Exception) {&#10;            // Xử lý lỗi lấy profile&#10;        }&#10;    }&#10;&#10;    fun logout() {&#10;        viewModelScope.launch {&#10;            try {&#10;                _authState.value = _authState.value.copy(isLoading = true)&#10;&#10;                val token = tokenManager.getAccessToken()&#10;                if (token != null) {&#10;                    authApi.logout(&quot;Bearer $token&quot;)&#10;                }&#10;&#10;                tokenManager.clearTokens()&#10;                _authState.value = AuthState(successMessage = &quot;Đã đăng xuất&quot;)&#10;            } catch (e: Exception) {&#10;                _authState.value = _authState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Lỗi đăng xuất: ${e.message}&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    fun loadUserProfile() {&#10;        viewModelScope.launch {&#10;            val token = tokenManager.getAccessToken()&#10;            if (token != null) {&#10;                fetchUserProfile(&quot;Bearer $token&quot;)&#10;            }&#10;        }&#10;    }&#10;&#10;    fun clearMessages() {&#10;        _authState.value = _authState.value.copy(errorMessage = null, successMessage = null)&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/HomePage.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/HomePage.kt" />
              <option name="originalContent" value="package com.example.prm_assignment.ui&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ExitToApp&#10;import androidx.compose.material.icons.filled.Build&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.prm_assignment.data.model.ProfileData&#10;&#10;@Composable&#10;fun HomePage(&#10;    modifier: Modifier = Modifier,&#10;    userProfile: ProfileData?,&#10;    onLogout: () -&gt; Unit = {}&#10;) {&#10;    Column(&#10;        modifier = modifier&#10;            .fillMaxSize()&#10;            .background(Color(0xFFF5F5F5))&#10;    ) {&#10;        // Header&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .background(Color(0xFF3D5A80))&#10;                .padding(vertical = 20.dp)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(horizontal = 16.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                Text(&#10;                    text = &quot;Car Maintenance Services&quot;,&#10;                    color = Color.White,&#10;                    fontSize = 20.sp,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                Text(&#10;                    text = &quot;Quản lý dịch vụ bảo dưỡng&quot;,&#10;                    color = Color.White.copy(alpha = 0.7f),&#10;                    fontSize = 12.sp&#10;                )&#10;            }&#10;        }&#10;&#10;        // User Info Card&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp)&#10;        ) {&#10;            Card(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clip(RoundedCornerShape(12.dp)),&#10;                elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;            ) {&#10;                Column(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .background(Color.White)&#10;                        .padding(20.dp),&#10;                    horizontalAlignment = Alignment.CenterHorizontally&#10;                ) {&#10;                    // Avatar placeholder&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(80.dp)&#10;                            .clip(CircleShape)&#10;                            .background(Color(0xFFEAF6FF)),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Default.Build,&#10;                            contentDescription = &quot;avatar&quot;,&#10;                            tint = Color(0xFF4B9BFF),&#10;                            modifier = Modifier.size(40.dp)&#10;                        )&#10;                    }&#10;&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                    // User Name&#10;                    Text(&#10;                        text = userProfile?.customerName ?: &quot;User&quot;,&#10;                        style = MaterialTheme.typography.headlineSmall.copy(&#10;                            fontWeight = FontWeight.Bold,&#10;                            fontSize = 18.sp&#10;                        ),&#10;                        textAlign = TextAlign.Center&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                    // Email&#10;                    Text(&#10;                        text = userProfile?.userId?.email ?: &quot;email@example.com&quot;,&#10;                        style = MaterialTheme.typography.bodyMedium,&#10;                        color = Color.Gray,&#10;                        textAlign = TextAlign.Center&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                    // Phone (if available)&#10;                    if (!userProfile?.userId?.phone.isNullOrEmpty()) {&#10;                        Row(&#10;                            modifier = Modifier&#10;                                .fillMaxWidth()&#10;                                .background(Color(0xFFF5F5F5))&#10;                                .padding(12.dp),&#10;                            horizontalArrangement = Arrangement.Center,&#10;                            verticalAlignment = Alignment.CenterVertically&#10;                        ) {&#10;                            Text(&#10;                                text = &quot;Số điện thoại: &quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                fontWeight = FontWeight.SemiBold&#10;                            )&#10;                            Text(&#10;                                text = userProfile?.userId?.phone ?: &quot;&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = Color(0xFF4B9BFF)&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(24.dp))&#10;&#10;            // Info Section&#10;            Card(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clip(RoundedCornerShape(12.dp)),&#10;                elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;            ) {&#10;                Column(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .background(Color.White)&#10;                        .padding(16.dp)&#10;                ) {&#10;                    Text(&#10;                        text = &quot;Thông tin&quot;,&#10;                        style = MaterialTheme.typography.bodyLarge.copy(&#10;                            fontWeight = FontWeight.Bold&#10;                        )&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                    InfoRow(label = &quot;ID&quot;, value = userProfile?.id ?: &quot;N/A&quot;)&#10;                    InfoRow(label = &quot;Tên khách hàng&quot;, value = userProfile?.customerName ?: &quot;N/A&quot;)&#10;                    InfoRow(label = &quot;Email&quot;, value = userProfile?.userId?.email ?: &quot;N/A&quot;)&#10;                    if (!userProfile?.userId?.phone.isNullOrEmpty()) {&#10;                        InfoRow(label = &quot;Số điện thoại&quot;, value = userProfile?.userId?.phone ?: &quot;N/A&quot;)&#10;                    }&#10;                    if (!userProfile?.address.isNullOrEmpty()) {&#10;                        InfoRow(label = &quot;Địa chỉ&quot;, value = userProfile?.address ?: &quot;N/A&quot;)&#10;                    }&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.weight(1f))&#10;&#10;            // Logout Button&#10;            Button(&#10;                onClick = onLogout,&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(50.dp),&#10;                shape = RoundedCornerShape(12.dp),&#10;                colors = ButtonDefaults.buttonColors(&#10;                    containerColor = Color(0xFFE53935)&#10;                )&#10;            ) {&#10;                Icon(&#10;                    imageVector = Icons.AutoMirrored.Filled.ExitToApp,&#10;                    contentDescription = &quot;logout&quot;,&#10;                    modifier = Modifier&#10;                        .size(20.dp)&#10;                        .padding(end = 8.dp),&#10;                    tint = Color.White&#10;                )&#10;                Text(&#10;                    text = &quot;Đăng xuất&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun InfoRow(label: String, value: String) {&#10;    Column(modifier = Modifier.fillMaxWidth()) {&#10;        Text(&#10;            text = label,&#10;            style = MaterialTheme.typography.bodySmall,&#10;            color = Color.Gray,&#10;            fontSize = 12.sp&#10;        )&#10;        Text(&#10;            text = value,&#10;            style = MaterialTheme.typography.bodyMedium,&#10;            fontWeight = FontWeight.SemiBold,&#10;            modifier = Modifier.padding(vertical = 4.dp)&#10;        )&#10;        HorizontalDivider(modifier = Modifier.padding(vertical = 8.dp))&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_assignment.ui&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ExitToApp&#10;import androidx.compose.material.icons.filled.Build&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.prm_assignment.data.model.ProfileResponse&#10;&#10;@Composable&#10;fun HomePage(&#10;    modifier: Modifier = Modifier,&#10;    userProfile: ProfileResponse.ProfileData?,&#10;    onLogout: () -&gt; Unit = {}&#10;) {&#10;    Column(&#10;        modifier = modifier&#10;            .fillMaxSize()&#10;            .background(Color(0xFFF5F5F5))&#10;    ) {&#10;        // Header&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .background(Color(0xFF3D5A80))&#10;                .padding(vertical = 20.dp)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(horizontal = 16.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                Text(&#10;                    text = &quot;Car Maintenance Services&quot;,&#10;                    color = Color.White,&#10;                    fontSize = 20.sp,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                Text(&#10;                    text = &quot;Quản lý dịch vụ bảo dưỡng&quot;,&#10;                    color = Color.White.copy(alpha = 0.7f),&#10;                    fontSize = 12.sp&#10;                )&#10;            }&#10;        }&#10;&#10;        // User Info Card&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp)&#10;        ) {&#10;            Card(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clip(RoundedCornerShape(12.dp)),&#10;                elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;            ) {&#10;                Column(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .background(Color.White)&#10;                        .padding(20.dp),&#10;                    horizontalAlignment = Alignment.CenterHorizontally&#10;                ) {&#10;                    // Avatar placeholder&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(80.dp)&#10;                            .clip(CircleShape)&#10;                            .background(Color(0xFFEAF6FF)),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Default.Build,&#10;                            contentDescription = &quot;avatar&quot;,&#10;                            tint = Color(0xFF4B9BFF),&#10;                            modifier = Modifier.size(40.dp)&#10;                        )&#10;                    }&#10;&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                    // User Name&#10;                    Text(&#10;                        text = userProfile?.customerName ?: &quot;User&quot;,&#10;                        style = MaterialTheme.typography.headlineSmall.copy(&#10;                            fontWeight = FontWeight.Bold,&#10;                            fontSize = 18.sp&#10;                        ),&#10;                        textAlign = TextAlign.Center&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                    // Email&#10;                    Text(&#10;                        text = userProfile?.userId?.email ?: &quot;email@example.com&quot;,&#10;                        style = MaterialTheme.typography.bodyMedium,&#10;                        color = Color.Gray,&#10;                        textAlign = TextAlign.Center&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                    // Phone (if available)&#10;                    if (!userProfile?.userId?.phone.isNullOrEmpty()) {&#10;                        Row(&#10;                            modifier = Modifier&#10;                                .fillMaxWidth()&#10;                                .background(Color(0xFFF5F5F5))&#10;                                .padding(12.dp),&#10;                            horizontalArrangement = Arrangement.Center,&#10;                            verticalAlignment = Alignment.CenterVertically&#10;                        ) {&#10;                            Text(&#10;                                text = &quot;Số điện thoại: &quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                fontWeight = FontWeight.SemiBold&#10;                            )&#10;                            Text(&#10;                                text = userProfile?.userId?.phone ?: &quot;&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = Color(0xFF4B9BFF)&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(24.dp))&#10;&#10;            // Info Section&#10;            Card(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clip(RoundedCornerShape(12.dp)),&#10;                elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;            ) {&#10;                Column(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .background(Color.White)&#10;                        .padding(16.dp)&#10;                ) {&#10;                    Text(&#10;                        text = &quot;Thông tin&quot;,&#10;                        style = MaterialTheme.typography.bodyLarge.copy(&#10;                            fontWeight = FontWeight.Bold&#10;                        )&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                    InfoRow(label = &quot;ID&quot;, value = userProfile?.id ?: &quot;N/A&quot;)&#10;                    InfoRow(label = &quot;Tên khách hàng&quot;, value = userProfile?.customerName ?: &quot;N/A&quot;)&#10;                    InfoRow(label = &quot;Email&quot;, value = userProfile?.userId?.email ?: &quot;N/A&quot;)&#10;                    if (!userProfile?.userId?.phone.isNullOrEmpty()) {&#10;                        InfoRow(label = &quot;Số điện thoại&quot;, value = userProfile?.userId?.phone ?: &quot;N/A&quot;)&#10;                    }&#10;                    if (!userProfile?.address.isNullOrEmpty()) {&#10;                        InfoRow(label = &quot;Địa chỉ&quot;, value = userProfile?.address ?: &quot;N/A&quot;)&#10;                    }&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.weight(1f))&#10;&#10;            // Logout Button&#10;            Button(&#10;                onClick = onLogout,&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(50.dp),&#10;                shape = RoundedCornerShape(12.dp),&#10;                colors = ButtonDefaults.buttonColors(&#10;                    containerColor = Color(0xFFE53935)&#10;                )&#10;            ) {&#10;                Icon(&#10;                    imageVector = Icons.AutoMirrored.Filled.ExitToApp,&#10;                    contentDescription = &quot;logout&quot;,&#10;                    modifier = Modifier&#10;                        .size(20.dp)&#10;                        .padding(end = 8.dp),&#10;                    tint = Color.White&#10;                )&#10;                Text(&#10;                    text = &quot;Đăng xuất&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun InfoRow(label: String, value: String) {&#10;    Column(modifier = Modifier.fillMaxWidth()) {&#10;        Text(&#10;            text = label,&#10;            style = MaterialTheme.typography.bodySmall,&#10;            color = Color.Gray,&#10;            fontSize = 12.sp&#10;        )&#10;        Text(&#10;            text = value,&#10;            style = MaterialTheme.typography.bodyMedium,&#10;            fontWeight = FontWeight.SemiBold,&#10;            modifier = Modifier.padding(vertical = 4.dp)&#10;        )&#10;        HorizontalDivider(modifier = Modifier.padding(vertical = 8.dp))&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/HomeFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/HomeFragment.java" />
              <option name="originalContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.annotation.SuppressLint;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.MotionEvent;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.FrameLayout;&#10;import android.widget.LinearLayout;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.cardview.widget.CardView;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.PackageModel;&#10;import com.example.prm_assignment.data.model.PackagesResponse;&#10;import com.example.prm_assignment.data.model.ProfileResponse;&#10;import com.example.prm_assignment.data.remote.PackagesApi;&#10;import com.example.prm_assignment.data.remote.PackagesRetrofitClient;&#10;import com.example.prm_assignment.data.remote.ProfileApi;&#10;import com.example.prm_assignment.data.remote.ProfileRetrofitClient;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.Locale;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class HomeFragment extends Fragment {&#10;    private static final String TAG = &quot;HomeFragment&quot;;&#10;&#10;    private float dX, dY;&#10;    private int lastAction;&#10;&#10;    private TextView tvGreeting;&#10;    private TextView tvCountry;&#10;    private LinearLayout llPackagesContainer;&#10;    private FrameLayout loadingOverlay;&#10;    private TokenHelper tokenHelper;&#10;    private PackagesApi packagesApi;&#10;    private ProfileApi profileApi;&#10;&#10;    // Track loading states&#10;    private boolean profileLoaded = false;&#10;    private boolean packagesLoaded = false;&#10;&#10;    @SuppressLint(&quot;ClickableViewAccessibility&quot;)&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_home, container, false);&#10;&#10;        // Initialize TokenHelper and API&#10;        tokenHelper = new TokenHelper(requireContext());&#10;        packagesApi = PackagesRetrofitClient.getInstance().getPackagesApi();&#10;        profileApi = ProfileRetrofitClient.getInstance().getProfileApi();&#10;&#10;        // Initialize views&#10;        tvGreeting = view.findViewById(R.id.tvGreeting);&#10;        tvCountry = view.findViewById(R.id.tvCountry);&#10;        llPackagesContainer = view.findViewById(R.id.llPackagesContainer);&#10;        loadingOverlay = view.findViewById(R.id.loadingOverlay);&#10;&#10;        // Check if views are found&#10;        if (tvGreeting == null) {&#10;            Log.e(TAG, &quot;tvGreeting is null!&quot;);&#10;        }&#10;        if (tvCountry == null) {&#10;            Log.e(TAG, &quot;tvCountry is null!&quot;);&#10;        }&#10;        if (llPackagesContainer == null) {&#10;            Log.e(TAG, &quot;llPackagesContainer is null!&quot;);&#10;        } else {&#10;            Log.d(TAG, &quot;llPackagesContainer found&quot;);&#10;        }&#10;&#10;        // Show loading at start&#10;        showLoading();&#10;&#10;        // Initialize chat bubble&#10;        CardView chatBubble = view.findViewById(R.id.chatBubble);&#10;        if (chatBubble == null) {&#10;            Log.w(TAG, &quot;chatBubble not found in layout&quot;);&#10;        } else {&#10;            chatBubble.setOnTouchListener((v, event) -&gt; {&#10;                switch (event.getActionMasked()) {&#10;                    case MotionEvent.ACTION_DOWN:&#10;                        dX = v.getX() - event.getRawX();&#10;                        dY = v.getY() - event.getRawY();&#10;                        lastAction = MotionEvent.ACTION_DOWN;&#10;                        // Scale down slightly when pressed for visual feedback&#10;                        v.animate().scaleX(0.9f).scaleY(0.9f).setDuration(100).start();&#10;                        break;&#10;&#10;                    case MotionEvent.ACTION_MOVE:&#10;                        // Calculate new position&#10;                        float newX = event.getRawX() + dX;&#10;                        float newY = event.getRawY() + dY;&#10;&#10;                        // Get parent dimensions for boundary checking&#10;                        ViewGroup parent = (ViewGroup) v.getParent();&#10;                        if (parent != null) {&#10;                            // Constrain X within parent bounds&#10;                            float maxX = parent.getWidth() - v.getWidth();&#10;                            newX = Math.max(0, Math.min(newX, maxX));&#10;&#10;                            // Constrain Y within parent bounds&#10;                            float maxY = parent.getHeight() - v.getHeight();&#10;                            newY = Math.max(0, Math.min(newY, maxY));&#10;                        }&#10;&#10;                        // Apply smooth movement with animation&#10;                        v.animate()&#10;                            .x(newX)&#10;                            .y(newY)&#10;                            .setDuration(0)&#10;                            .start();&#10;&#10;                        lastAction = MotionEvent.ACTION_MOVE;&#10;                        break;&#10;&#10;                    case MotionEvent.ACTION_UP:&#10;                        // Scale back to normal&#10;                        v.animate().scaleX(1f).scaleY(1f).setDuration(100).start();&#10;&#10;                        if (lastAction == MotionEvent.ACTION_DOWN) {&#10;                            // This was a click, not a drag&#10;                            v.performClick();&#10;                            Toast.makeText(getContext(), &quot;Chat đang được phát triển&quot;, Toast.LENGTH_SHORT).show();&#10;                        }&#10;                        break;&#10;&#10;                    default:&#10;                        return false;&#10;                }&#10;                return true;&#10;            });&#10;        }&#10;&#10;        // Load data from API&#10;        loadProfileData();&#10;        loadPackagesData();&#10;&#10;        return view;&#10;    }&#10;&#10;    private void showLoading() {&#10;        if (loadingOverlay != null) {&#10;            loadingOverlay.setVisibility(View.VISIBLE);&#10;            Log.d(TAG, &quot;Loading overlay shown&quot;);&#10;        }&#10;    }&#10;&#10;    private void hideLoading() {&#10;        if (loadingOverlay != null) {&#10;            loadingOverlay.setVisibility(View.GONE);&#10;            Log.d(TAG, &quot;Loading overlay hidden&quot;);&#10;        }&#10;    }&#10;&#10;    private void checkAndHideLoading() {&#10;        // Hide loading only when both profile and packages are loaded&#10;        if (profileLoaded &amp;&amp; packagesLoaded) {&#10;            hideLoading();&#10;            Log.d(TAG, &quot;All data loaded, hiding loading overlay&quot;);&#10;        }&#10;    }&#10;&#10;    private void addPackageCard(PackageModel packageModel) {&#10;        if (llPackagesContainer == null) {&#10;            Log.e(TAG, &quot;llPackagesContainer is null, cannot add card&quot;);&#10;            return;&#10;        }&#10;&#10;        // Inflate the package card layout&#10;        View cardView = LayoutInflater.from(getContext()).inflate(R.layout.item_package, llPackagesContainer, false);&#10;&#10;        // Find views in the card&#10;        TextView tvPackageName = cardView.findViewById(R.id.tvPackageName);&#10;        TextView tvPackagePrice = cardView.findViewById(R.id.tvPackagePrice);&#10;        CardView btnBookNow = cardView.findViewById(R.id.btnBookNow);&#10;&#10;        // Set data&#10;        tvPackageName.setText(packageModel.getName());&#10;&#10;        // Format price&#10;        NumberFormat formatter = NumberFormat.getNumberInstance(new Locale(&quot;vi&quot;, &quot;VN&quot;));&#10;        String formattedPrice = formatter.format(packageModel.getPrice()) + &quot; VND&quot;;&#10;        tvPackagePrice.setText(formattedPrice);&#10;&#10;        // Set click listener&#10;        btnBookNow.setOnClickListener(v -&gt; {&#10;            Toast.makeText(getContext(), &quot;Đặt gói: &quot; + packageModel.getName(), Toast.LENGTH_SHORT).show();&#10;        });&#10;&#10;        cardView.setOnClickListener(v -&gt; {&#10;            Toast.makeText(getContext(), &quot;Selected: &quot; + packageModel.getName(), Toast.LENGTH_SHORT).show();&#10;        });&#10;&#10;        // Add card to container&#10;        llPackagesContainer.addView(cardView);&#10;    }&#10;&#10;    private void loadProfileData() {&#10;        Log.d(TAG, &quot;loadProfileData: Starting to load profile&quot;);&#10;        profileLoaded = false;&#10;        tokenHelper.getTokenAndExecute(token -&gt; {&#10;            Log.d(TAG, &quot;Token retrieved: &quot; + (token != null ? &quot;Yes (length=&quot; + token.length() + &quot;)&quot; : &quot;No&quot;));&#10;            if (token != null &amp;&amp; !token.isEmpty()) {&#10;                fetchProfile(&quot;Bearer &quot; + token);&#10;            } else {&#10;                Log.e(TAG, &quot;No token found&quot;);&#10;                if (tvGreeting != null) {&#10;                    tvGreeting.setText(&quot;Xin chào, Khách&quot;);&#10;                }&#10;                // Mark as loaded even if failed&#10;                profileLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void fetchProfile(String authHeader) {&#10;        Log.d(TAG, &quot;fetchProfile: Making API call&quot;);&#10;        profileApi.getProfile(authHeader).enqueue(new Callback&lt;ProfileResponse&gt;() {&#10;            @Override&#10;            public void onResponse(@NonNull Call&lt;ProfileResponse&gt; call, @NonNull Response&lt;ProfileResponse&gt; response) {&#10;                Log.d(TAG, &quot;Profile API response received: &quot; + response.code());&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ProfileResponse profileResponse = response.body();&#10;                    if (profileResponse.getSuccess() &amp;&amp; profileResponse.getData() != null) {&#10;                        String customerName = profileResponse.getData().getCustomerName();&#10;                        String address = profileResponse.getData().getAddress();&#10;                        Log.d(TAG, &quot;Customer name from API: &quot; + customerName);&#10;                        Log.d(TAG, &quot;Address from API: &quot; + address);&#10;&#10;                        if (tvGreeting != null) {&#10;                            if (customerName != null &amp;&amp; !customerName.isEmpty()) {&#10;                                tvGreeting.setText(&quot;Xin chào, &quot; + customerName);&#10;                            } else {&#10;                                tvGreeting.setText(&quot;Xin chào, Khách hàng&quot;);&#10;                            }&#10;                        }&#10;&#10;                        if (tvCountry != null) {&#10;                            if (address != null &amp;&amp; !address.isEmpty()) {&#10;                                tvCountry.setText(address);&#10;                            } else {&#10;                                tvCountry.setText(&quot;Việt Nam&quot;);&#10;                            }&#10;                        }&#10;                    } else {&#10;                        Log.w(TAG, &quot;Profile response unsuccessful or data is null&quot;);&#10;                        if (tvGreeting != null) {&#10;                            tvGreeting.setText(&quot;Xin chào, Khách hàng&quot;);&#10;                        }&#10;                        if (tvCountry != null) {&#10;                            tvCountry.setText(&quot;Việt Nam&quot;);&#10;                        }&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;Profile fetch failed: &quot; + response.code());&#10;                    if (tvGreeting != null) {&#10;                        tvGreeting.setText(&quot;Xin chào, Khách hàng&quot;);&#10;                    }&#10;                    if (tvCountry != null) {&#10;                        tvCountry.setText(&quot;Việt Nam&quot;);&#10;                    }&#10;                }&#10;&#10;                // Mark profile as loaded&#10;                profileLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(@NonNull Call&lt;ProfileResponse&gt; call, @NonNull Throwable t) {&#10;                Log.e(TAG, &quot;Profile fetch error: &quot; + t.getMessage(), t);&#10;                if (tvGreeting != null) {&#10;                    tvGreeting.setText(&quot;Xin chào, Khách hàng&quot;);&#10;                }&#10;                if (tvCountry != null) {&#10;                    tvCountry.setText(&quot;Việt Nam&quot;);&#10;                }&#10;&#10;                // Mark profile as loaded even on failure&#10;                profileLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadPackagesData() {&#10;        Log.d(TAG, &quot;loadPackagesData: Starting to load packages&quot;);&#10;        packagesLoaded = false;&#10;        tokenHelper.getTokenAndExecute(token -&gt; {&#10;            Log.d(TAG, &quot;Token retrieved for packages: &quot; + (token != null ? &quot;Yes&quot; : &quot;No&quot;));&#10;            if (token != null &amp;&amp; !token.isEmpty()) {&#10;                Log.d(TAG, &quot;Calling fetchPackages with token&quot;);&#10;                fetchPackages(&quot;Bearer &quot; + token);&#10;            } else {&#10;                Log.e(TAG, &quot;No token found for packages&quot;);&#10;                Toast.makeText(getContext(), &quot;Vui lòng đăng nhập&quot;, Toast.LENGTH_SHORT).show();&#10;                // Mark as loaded even if failed&#10;                packagesLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void fetchPackages(String authHeader) {&#10;        Log.d(TAG, &quot;fetchPackages: Making API call&quot;);&#10;        Log.d(TAG, &quot;Auth header: &quot; + authHeader.substring(0, Math.min(20, authHeader.length())) + &quot;...&quot;);&#10;        Log.d(TAG, &quot;Base URL: &quot; + com.example.prm_assignment.BuildConfig.BASE_URL);&#10;&#10;        packagesApi.getPackages(authHeader).enqueue(new Callback&lt;PackagesResponse&gt;() {&#10;            @Override&#10;            public void onResponse(@NonNull Call&lt;PackagesResponse&gt; call, @NonNull Response&lt;PackagesResponse&gt; response) {&#10;                Log.d(TAG, &quot;Packages API response received&quot;);&#10;                Log.d(TAG, &quot;Response code: &quot; + response.code());&#10;                Log.d(TAG, &quot;Response URL: &quot; + call.request().url());&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    PackagesResponse packagesResponse = response.body();&#10;                    Log.d(TAG, &quot;Response successful: &quot; + packagesResponse.isSuccess());&#10;                    if (packagesResponse.isSuccess() &amp;&amp; packagesResponse.getData() != null) {&#10;                        Log.d(TAG, &quot;Loaded &quot; + packagesResponse.getData().size() + &quot; packages&quot;);&#10;&#10;                        // Clear existing cards&#10;                        if (llPackagesContainer != null) {&#10;                            llPackagesContainer.removeAllViews();&#10;                        }&#10;&#10;                        // Add each package as a card&#10;                        for (PackageModel packageModel : packagesResponse.getData()) {&#10;                            addPackageCard(packageModel);&#10;                        }&#10;&#10;//                        Toast.makeText(getContext(), &quot;Đã tải &quot; + packagesResponse.getData().size() + &quot; gói dịch vụ&quot;, Toast.LENGTH_SHORT).show();&#10;                    } else {&#10;                        Log.w(TAG, &quot;Response body empty or unsuccessful&quot;);&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;Packages fetch failed: &quot; + response.code() + &quot; - &quot; + response.message());&#10;                    Toast.makeText(getContext(), &quot;Không thể tải gói dịch vụ: &quot; + response.code(), Toast.LENGTH_SHORT).show();&#10;                }&#10;&#10;                // Mark packages as loaded&#10;                packagesLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(@NonNull Call&lt;PackagesResponse&gt; call, @NonNull Throwable t) {&#10;                Log.e(TAG, &quot;Packages fetch error: &quot; + t.getMessage(), t);&#10;                Toast.makeText(getContext(), &quot;Lỗi kết nối: &quot; + t.getMessage(), Toast.LENGTH_SHORT).show();&#10;&#10;                // Mark packages as loaded even on failure&#10;                packagesLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;        });&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.annotation.SuppressLint;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.MotionEvent;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.FrameLayout;&#10;import android.widget.LinearLayout;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.cardview.widget.CardView;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.PackageModel;&#10;import com.example.prm_assignment.data.model.PackagesResponse;&#10;import com.example.prm_assignment.data.model.ProfileResponse;&#10;import com.example.prm_assignment.data.remote.PackagesApi;&#10;import com.example.prm_assignment.data.remote.PackagesRetrofitClient;&#10;import com.example.prm_assignment.data.remote.ProfileApi;&#10;import com.example.prm_assignment.data.remote.ProfileRetrofitClient;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.Locale;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class HomeFragment extends Fragment {&#10;    private static final String TAG = &quot;HomeFragment&quot;;&#10;&#10;    private float dX, dY;&#10;    private int lastAction;&#10;&#10;    private TextView tvGreeting;&#10;    private TextView tvCountry;&#10;    private LinearLayout llPackagesContainer;&#10;    private FrameLayout loadingOverlay;&#10;    private TokenHelper tokenHelper;&#10;    private PackagesApi packagesApi;&#10;    private ProfileApi profileApi;&#10;&#10;    // Track loading states&#10;    private boolean profileLoaded = false;&#10;    private boolean packagesLoaded = false;&#10;&#10;    @SuppressLint(&quot;ClickableViewAccessibility&quot;)&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_home, container, false);&#10;&#10;        // Initialize TokenHelper and API&#10;        tokenHelper = new TokenHelper(requireContext());&#10;        packagesApi = PackagesRetrofitClient.getInstance().getPackagesApi();&#10;        profileApi = ProfileRetrofitClient.getInstance().getProfileApi();&#10;&#10;        // Initialize views&#10;        tvGreeting = view.findViewById(R.id.tvGreeting);&#10;        tvCountry = view.findViewById(R.id.tvCountry);&#10;        llPackagesContainer = view.findViewById(R.id.llPackagesContainer);&#10;        loadingOverlay = view.findViewById(R.id.loadingOverlay);&#10;&#10;        // Check if views are found&#10;        if (tvGreeting == null) {&#10;            Log.e(TAG, &quot;tvGreeting is null!&quot;);&#10;        }&#10;        if (tvCountry == null) {&#10;            Log.e(TAG, &quot;tvCountry is null!&quot;);&#10;        }&#10;        if (llPackagesContainer == null) {&#10;            Log.e(TAG, &quot;llPackagesContainer is null!&quot;);&#10;        } else {&#10;            Log.d(TAG, &quot;llPackagesContainer found&quot;);&#10;        }&#10;&#10;        // Show loading at start&#10;        showLoading();&#10;&#10;        // Initialize chat bubble&#10;        CardView chatBubble = view.findViewById(R.id.chatBubble);&#10;        if (chatBubble == null) {&#10;            Log.w(TAG, &quot;chatBubble not found in layout&quot;);&#10;        } else {&#10;            chatBubble.setOnTouchListener((v, event) -&gt; {&#10;                switch (event.getActionMasked()) {&#10;                    case MotionEvent.ACTION_DOWN:&#10;                        dX = v.getX() - event.getRawX();&#10;                        dY = v.getY() - event.getRawY();&#10;                        lastAction = MotionEvent.ACTION_DOWN;&#10;                        // Scale down slightly when pressed for visual feedback&#10;                        v.animate().scaleX(0.9f).scaleY(0.9f).setDuration(100).start();&#10;                        break;&#10;&#10;                    case MotionEvent.ACTION_MOVE:&#10;                        // Calculate new position&#10;                        float newX = event.getRawX() + dX;&#10;                        float newY = event.getRawY() + dY;&#10;&#10;                        // Get parent dimensions for boundary checking&#10;                        ViewGroup parent = (ViewGroup) v.getParent();&#10;                        if (parent != null) {&#10;                            // Constrain X within parent bounds&#10;                            float maxX = parent.getWidth() - v.getWidth();&#10;                            newX = Math.max(0, Math.min(newX, maxX));&#10;&#10;                            // Constrain Y within parent bounds&#10;                            float maxY = parent.getHeight() - v.getHeight();&#10;                            newY = Math.max(0, Math.min(newY, maxY));&#10;                        }&#10;&#10;                        // Apply smooth movement with animation&#10;                        v.animate()&#10;                            .x(newX)&#10;                            .y(newY)&#10;                            .setDuration(0)&#10;                            .start();&#10;&#10;                        lastAction = MotionEvent.ACTION_MOVE;&#10;                        break;&#10;&#10;                    case MotionEvent.ACTION_UP:&#10;                        // Scale back to normal&#10;                        v.animate().scaleX(1f).scaleY(1f).setDuration(100).start();&#10;&#10;                        if (lastAction == MotionEvent.ACTION_DOWN) {&#10;                            // This was a click, not a drag&#10;                            v.performClick();&#10;                            Toast.makeText(getContext(), &quot;Chat đang được phát triển&quot;, Toast.LENGTH_SHORT).show();&#10;                        }&#10;                        break;&#10;&#10;                    default:&#10;                        return false;&#10;                }&#10;                return true;&#10;            });&#10;        }&#10;&#10;        // Load data from API&#10;        loadProfileData();&#10;        loadPackagesData();&#10;&#10;        return view;&#10;    }&#10;&#10;    private void showLoading() {&#10;        if (loadingOverlay != null) {&#10;            loadingOverlay.setVisibility(View.VISIBLE);&#10;            Log.d(TAG, &quot;Loading overlay shown&quot;);&#10;        }&#10;    }&#10;&#10;    private void hideLoading() {&#10;        if (loadingOverlay != null) {&#10;            loadingOverlay.setVisibility(View.GONE);&#10;            Log.d(TAG, &quot;Loading overlay hidden&quot;);&#10;        }&#10;    }&#10;&#10;    private void checkAndHideLoading() {&#10;        // Hide loading only when both profile and packages are loaded&#10;        if (profileLoaded &amp;&amp; packagesLoaded) {&#10;            hideLoading();&#10;            Log.d(TAG, &quot;All data loaded, hiding loading overlay&quot;);&#10;        }&#10;    }&#10;&#10;    private void addPackageCard(PackageModel packageModel) {&#10;        if (llPackagesContainer == null) {&#10;            Log.e(TAG, &quot;llPackagesContainer is null, cannot add card&quot;);&#10;            return;&#10;        }&#10;&#10;        // Inflate the package card layout&#10;        View cardView = LayoutInflater.from(getContext()).inflate(R.layout.item_package, llPackagesContainer, false);&#10;&#10;        // Find views in the card&#10;        TextView tvPackageName = cardView.findViewById(R.id.tvPackageName);&#10;        TextView tvPackagePrice = cardView.findViewById(R.id.tvPackagePrice);&#10;        CardView btnBookNow = cardView.findViewById(R.id.btnBookNow);&#10;&#10;        // Set data&#10;        tvPackageName.setText(packageModel.getName());&#10;&#10;        // Format price&#10;        NumberFormat formatter = NumberFormat.getNumberInstance(new Locale(&quot;vi&quot;, &quot;VN&quot;));&#10;        String formattedPrice = formatter.format(packageModel.getPrice()) + &quot; VND&quot;;&#10;        tvPackagePrice.setText(formattedPrice);&#10;&#10;        // Set click listener&#10;        btnBookNow.setOnClickListener(v -&gt; {&#10;            Toast.makeText(getContext(), &quot;Đặt gói: &quot; + packageModel.getName(), Toast.LENGTH_SHORT).show();&#10;        });&#10;&#10;        cardView.setOnClickListener(v -&gt; {&#10;            Toast.makeText(getContext(), &quot;Selected: &quot; + packageModel.getName(), Toast.LENGTH_SHORT).show();&#10;        });&#10;&#10;        // Add card to container&#10;        llPackagesContainer.addView(cardView);&#10;    }&#10;&#10;    private void loadProfileData() {&#10;        Log.d(TAG, &quot;loadProfileData: Starting to load profile&quot;);&#10;        profileLoaded = false;&#10;        tokenHelper.getTokenAndExecute(token -&gt; {&#10;            Log.d(TAG, &quot;Token retrieved: &quot; + (token != null ? &quot;Yes (length=&quot; + token.length() + &quot;)&quot; : &quot;No&quot;));&#10;            if (token != null &amp;&amp; !token.isEmpty()) {&#10;                fetchProfile(&quot;Bearer &quot; + token);&#10;            } else {&#10;                Log.e(TAG, &quot;No token found&quot;);&#10;                if (tvGreeting != null) {&#10;                    tvGreeting.setText(&quot;Xin chào, Khách&quot;);&#10;                }&#10;                // Mark as loaded even if failed&#10;                profileLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void fetchProfile(String authHeader) {&#10;        Log.d(TAG, &quot;fetchProfile: Making API call&quot;);&#10;        profileApi.getProfile(authHeader).enqueue(new Callback&lt;ProfileResponse&gt;() {&#10;            @Override&#10;            public void onResponse(@NonNull Call&lt;ProfileResponse&gt; call, @NonNull Response&lt;ProfileResponse&gt; response) {&#10;                Log.d(TAG, &quot;Profile API response received: &quot; + response.code());&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ProfileResponse profileResponse = response.body();&#10;                    if (profileResponse.isSuccess() &amp;&amp; profileResponse.getData() != null) {&#10;                        String customerName = profileResponse.getData().getCustomerName();&#10;                        String address = profileResponse.getData().getAddress();&#10;                        Log.d(TAG, &quot;Customer name from API: &quot; + customerName);&#10;                        Log.d(TAG, &quot;Address from API: &quot; + address);&#10;&#10;                        if (tvGreeting != null) {&#10;                            if (customerName != null &amp;&amp; !customerName.isEmpty()) {&#10;                                tvGreeting.setText(&quot;Xin chào, &quot; + customerName);&#10;                            } else {&#10;                                tvGreeting.setText(&quot;Xin chào, Khách hàng&quot;);&#10;                            }&#10;                        }&#10;&#10;                        if (tvCountry != null) {&#10;                            if (address != null &amp;&amp; !address.isEmpty()) {&#10;                                tvCountry.setText(address);&#10;                            } else {&#10;                                tvCountry.setText(&quot;Việt Nam&quot;);&#10;                            }&#10;                        }&#10;                    } else {&#10;                        Log.w(TAG, &quot;Profile response unsuccessful or data is null&quot;);&#10;                        if (tvGreeting != null) {&#10;                            tvGreeting.setText(&quot;Xin chào, Khách hàng&quot;);&#10;                        }&#10;                        if (tvCountry != null) {&#10;                            tvCountry.setText(&quot;Việt Nam&quot;);&#10;                        }&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;Profile fetch failed: &quot; + response.code());&#10;                    if (tvGreeting != null) {&#10;                        tvGreeting.setText(&quot;Xin chào, Khách hàng&quot;);&#10;                    }&#10;                    if (tvCountry != null) {&#10;                        tvCountry.setText(&quot;Việt Nam&quot;);&#10;                    }&#10;                }&#10;&#10;                // Mark profile as loaded&#10;                profileLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(@NonNull Call&lt;ProfileResponse&gt; call, @NonNull Throwable t) {&#10;                Log.e(TAG, &quot;Profile fetch error: &quot; + t.getMessage(), t);&#10;                if (tvGreeting != null) {&#10;                    tvGreeting.setText(&quot;Xin chào, Khách hàng&quot;);&#10;                }&#10;                if (tvCountry != null) {&#10;                    tvCountry.setText(&quot;Việt Nam&quot;);&#10;                }&#10;&#10;                // Mark profile as loaded even on failure&#10;                profileLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadPackagesData() {&#10;        Log.d(TAG, &quot;loadPackagesData: Starting to load packages&quot;);&#10;        packagesLoaded = false;&#10;        tokenHelper.getTokenAndExecute(token -&gt; {&#10;            Log.d(TAG, &quot;Token retrieved for packages: &quot; + (token != null ? &quot;Yes&quot; : &quot;No&quot;));&#10;            if (token != null &amp;&amp; !token.isEmpty()) {&#10;                Log.d(TAG, &quot;Calling fetchPackages with token&quot;);&#10;                fetchPackages(&quot;Bearer &quot; + token);&#10;            } else {&#10;                Log.e(TAG, &quot;No token found for packages&quot;);&#10;                Toast.makeText(getContext(), &quot;Vui lòng đăng nhập&quot;, Toast.LENGTH_SHORT).show();&#10;                // Mark as loaded even if failed&#10;                packagesLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void fetchPackages(String authHeader) {&#10;        Log.d(TAG, &quot;fetchPackages: Making API call&quot;);&#10;        Log.d(TAG, &quot;Auth header: &quot; + authHeader.substring(0, Math.min(20, authHeader.length())) + &quot;...&quot;);&#10;        Log.d(TAG, &quot;Base URL: &quot; + com.example.prm_assignment.BuildConfig.BASE_URL);&#10;&#10;        packagesApi.getPackages(authHeader).enqueue(new Callback&lt;PackagesResponse&gt;() {&#10;            @Override&#10;            public void onResponse(@NonNull Call&lt;PackagesResponse&gt; call, @NonNull Response&lt;PackagesResponse&gt; response) {&#10;                Log.d(TAG, &quot;Packages API response received&quot;);&#10;                Log.d(TAG, &quot;Response code: &quot; + response.code());&#10;                Log.d(TAG, &quot;Response URL: &quot; + call.request().url());&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    PackagesResponse packagesResponse = response.body();&#10;                    Log.d(TAG, &quot;Response successful: &quot; + packagesResponse.isSuccess());&#10;                    if (packagesResponse.isSuccess() &amp;&amp; packagesResponse.getData() != null) {&#10;                        Log.d(TAG, &quot;Loaded &quot; + packagesResponse.getData().size() + &quot; packages&quot;);&#10;&#10;                        // Clear existing cards&#10;                        if (llPackagesContainer != null) {&#10;                            llPackagesContainer.removeAllViews();&#10;                        }&#10;&#10;                        // Add each package as a card&#10;                        for (PackageModel packageModel : packagesResponse.getData()) {&#10;                            addPackageCard(packageModel);&#10;                        }&#10;&#10;//                        Toast.makeText(getContext(), &quot;Đã tải &quot; + packagesResponse.getData().size() + &quot; gói dịch vụ&quot;, Toast.LENGTH_SHORT).show();&#10;                    } else {&#10;                        Log.w(TAG, &quot;Response body empty or unsuccessful&quot;);&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;Packages fetch failed: &quot; + response.code() + &quot; - &quot; + response.message());&#10;                    Toast.makeText(getContext(), &quot;Không thể tải gói dịch vụ: &quot; + response.code(), Toast.LENGTH_SHORT).show();&#10;                }&#10;&#10;                // Mark packages as loaded&#10;                packagesLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(@NonNull Call&lt;PackagesResponse&gt; call, @NonNull Throwable t) {&#10;                Log.e(TAG, &quot;Packages fetch error: &quot; + t.getMessage(), t);&#10;                Toast.makeText(getContext(), &quot;Lỗi kết nối: &quot; + t.getMessage(), Toast.LENGTH_SHORT).show();&#10;&#10;                // Mark packages as loaded even on failure&#10;                packagesLoaded = true;&#10;                checkAndHideLoading();&#10;            }&#10;        });&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/ProfileFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/ProfileFragment.java" />
              <option name="originalContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.animation.ObjectAnimator;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.os.Handler;&#10;import android.os.Looper;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.LinearLayout;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.viewpager2.widget.ViewPager2;&#10;&#10;import com.example.prm_assignment.MainActivity;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.ProfileResponse;&#10;import com.example.prm_assignment.data.model.VehicleModel;&#10;import com.example.prm_assignment.data.model.VehicleResponse;&#10;import com.example.prm_assignment.data.remote.VehiclesRetrofitClient;&#10;import com.example.prm_assignment.ui.adapters.VehicleImagePagerAdapter;&#10;import com.google.android.material.button.MaterialButton;&#10;import com.google.android.material.card.MaterialCardView;&#10;&#10;import java.text.ParseException;&#10;import java.text.SimpleDateFormat;&#10;import java.util.ArrayList;&#10;import java.util.Date;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class ProfileFragment extends Fragment {&#10;    private static final String TAG = &quot;ProfileFragment&quot;;&#10;&#10;    private ViewPager2 vehicleImagePager;&#10;    private LinearLayout indicatorContainer;&#10;    private MaterialCardView vehicleInfoCard;&#10;//    private ImageView vehicleAvatar;&#10;    private TextView tvVehicleNameProfile;&#10;    private TextView tvMileage;&#10;    private TextView tvLastServiceDate;&#10;    private TextView tvCustomerName;&#10;    private TextView tvEmail;&#10;    private TextView tvPhone;&#10;    private TextView tvAddress;&#10;    private LinearLayout phoneLayout;&#10;    private LinearLayout addressLayout;&#10;    private MaterialButton btnLogout;&#10;&#10;    private List&lt;VehicleModel&gt; vehicles = new ArrayList&lt;&gt;();&#10;    private VehicleImagePagerAdapter pagerAdapter;&#10;    private Handler handler = new Handler(Looper.getMainLooper());&#10;    private int currentPage = 0;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_profile, container, false);&#10;&#10;        initViews(view);&#10;        setupViewPager();&#10;        loadData();&#10;&#10;        return view;&#10;    }&#10;&#10;    private void initViews(View view) {&#10;        vehicleImagePager = view.findViewById(R.id.vehicleImagePager);&#10;        indicatorContainer = view.findViewById(R.id.indicatorContainer);&#10;        vehicleInfoCard = view.findViewById(R.id.vehicleInfoCard);&#10;//        vehicleAvatar = view.findViewById(R.id.vehicleAvatar);&#10;        tvVehicleNameProfile = view.findViewById(R.id.tvVehicleNameProfile);&#10;        tvMileage = view.findViewById(R.id.tvMileage);&#10;        tvLastServiceDate = view.findViewById(R.id.tvLastServiceDate);&#10;        tvCustomerName = view.findViewById(R.id.tvCustomerName);&#10;        tvEmail = view.findViewById(R.id.tvEmail);&#10;        tvPhone = view.findViewById(R.id.tvPhone);&#10;        tvAddress = view.findViewById(R.id.tvAddress);&#10;        phoneLayout = view.findViewById(R.id.phoneLayout);&#10;        addressLayout = view.findViewById(R.id.addressLayout);&#10;        btnLogout = view.findViewById(R.id.btnLogout);&#10;&#10;        btnLogout.setOnClickListener(v -&gt; logout());&#10;    }&#10;&#10;    private void setupViewPager() {&#10;        pagerAdapter = new VehicleImagePagerAdapter(vehicles, (vehicle, position) -&gt; {&#10;            // Handle image click if needed&#10;        });&#10;        vehicleImagePager.setAdapter(pagerAdapter);&#10;&#10;        vehicleImagePager.registerOnPageChangeCallback(new ViewPager2.OnPageChangeCallback() {&#10;            @Override&#10;            public void onPageSelected(int position) {&#10;                super.onPageSelected(position);&#10;                currentPage = position;&#10;                updateIndicators(position);&#10;                updateVehicleInfo(position);&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadData() {&#10;        loadProfile();&#10;        loadVehicles();&#10;    }&#10;&#10;    private void loadProfile() {&#10;        TokenHelper.loadProfileAsync(requireContext(), new TokenHelper.ProfileCallback() {&#10;            @Override&#10;            public void onSuccess(ProfileResponse response) {&#10;                if (response != null &amp;&amp; response.getData() != null) {&#10;                    updateProfileUI(response.getData());&#10;                } else {&#10;                    showError(&quot;Failed to load profile&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onError(String message) {&#10;                if (&quot;Token not found&quot;.equals(message)) {&#10;                    showError(&quot;Token not found. Please login again.&quot;);&#10;                    logout();&#10;                } else {&#10;                    showError(&quot;Error: &quot; + message);&#10;                    Log.e(TAG, &quot;Profile load error: &quot; + message);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadVehicles() {&#10;        TokenHelper.getAccessTokenAsync(requireContext(), token -&gt; {&#10;            if (token == null) return;&#10;&#10;            VehiclesRetrofitClient.getInstance().getVehiclesApi()&#10;                    .getMyVehicles(&quot;Bearer &quot; + token)&#10;                    .enqueue(new Callback&lt;VehicleResponse&gt;() {&#10;                        @Override&#10;                        public void onResponse(@NonNull Call&lt;VehicleResponse&gt; call, @NonNull Response&lt;VehicleResponse&gt; response) {&#10;                            if (response.isSuccessful() &amp;&amp; response.body() != null &amp;&amp; response.body().getData() != null) {&#10;                                vehicles.clear();&#10;                                vehicles.addAll(response.body().getData());&#10;                                pagerAdapter.updateVehicles(vehicles);&#10;&#10;                                if (!vehicles.isEmpty()) {&#10;                                    setupIndicators();&#10;                                    updateVehicleInfo(0);&#10;                                    startAutoScroll();&#10;                                }&#10;                            }&#10;                        }&#10;&#10;                        @Override&#10;                        public void onFailure(@NonNull Call&lt;VehicleResponse&gt; call, @NonNull Throwable t) {&#10;                            Log.e(TAG, &quot;Vehicles load error&quot;, t);&#10;                        }&#10;                    });&#10;        });&#10;    }&#10;&#10;    private void updateProfileUI(com.example.prm_assignment.data.model.ProfileResponse profile) {&#10;        if (profile == null) return;&#10;&#10;        tvCustomerName.setText(profile.getCustomerName() != null ? profile.getCustomerName() : &quot;N/A&quot;);&#10;        tvEmail.setText(profile.getUserId() != null &amp;&amp; profile.getUserId().getEmail() != null&#10;                ? profile.getUserId().getEmail() : &quot;N/A&quot;);&#10;&#10;        if (profile.getUserId() != null &amp;&amp; profile.getUserId().getPhone() != null &amp;&amp; !profile.getUserId().getPhone().isEmpty()) {&#10;            phoneLayout.setVisibility(View.VISIBLE);&#10;            tvPhone.setText(profile.getUserId().getPhone());&#10;        } else {&#10;            phoneLayout.setVisibility(View.GONE);&#10;        }&#10;&#10;        if (profile.getAddress() != null &amp;&amp; !profile.getAddress().isEmpty()) {&#10;            addressLayout.setVisibility(View.VISIBLE);&#10;            tvAddress.setText(profile.getAddress());&#10;        } else {&#10;            addressLayout.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    private void updateVehicleInfo(int position) {&#10;        if (vehicles.isEmpty() || position &gt;= vehicles.size()) return;&#10;&#10;        VehicleModel vehicle = vehicles.get(position);&#10;&#10;        // Fade out animation&#10;        ObjectAnimator fadeOut = ObjectAnimator.ofFloat(vehicleInfoCard, &quot;alpha&quot;, 1f, 0f);&#10;        fadeOut.setDuration(300);&#10;        fadeOut.start();&#10;&#10;        handler.postDelayed(() -&gt; {&#10;            // Update info&#10;            tvVehicleNameProfile.setText(vehicle.getVehicleName() != null ? vehicle.getVehicleName() : &quot;N/A&quot;);&#10;            tvMileage.setText(String.format(Locale.getDefault(), &quot;%.0f km&quot;, vehicle.getMileage()));&#10;&#10;            String lastServiceDate = vehicle.getLastServiceDate();&#10;            if (lastServiceDate != null &amp;&amp; !lastServiceDate.isEmpty()) {&#10;                tvLastServiceDate.setText(formatDate(lastServiceDate));&#10;            } else {&#10;                tvLastServiceDate.setText(&quot;Chưa bảo dưỡng&quot;);&#10;            }&#10;&#10;            // Fade in animation&#10;            ObjectAnimator fadeIn = ObjectAnimator.ofFloat(vehicleInfoCard, &quot;alpha&quot;, 0f, 1f);&#10;            fadeIn.setDuration(300);&#10;            fadeIn.start();&#10;        }, 300);&#10;    }&#10;&#10;    private String formatDate(String dateString) {&#10;        try {&#10;            SimpleDateFormat inputFormat = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;, Locale.getDefault());&#10;            SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;, Locale.getDefault());&#10;            Date date = inputFormat.parse(dateString);&#10;            return date != null ? outputFormat.format(date) : dateString;&#10;        } catch (ParseException e) {&#10;            return dateString;&#10;        }&#10;    }&#10;&#10;    private void setupIndicators() {&#10;        indicatorContainer.removeAllViews();&#10;        ImageView[] indicators = new ImageView[vehicles.size()];&#10;&#10;        for (int i = 0; i &lt; vehicles.size(); i++) {&#10;            indicators[i] = new ImageView(requireContext());&#10;            indicators[i].setImageDrawable(getResources().getDrawable(R.drawable.indicator_inactive, null));&#10;&#10;            LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(&#10;                    LinearLayout.LayoutParams.WRAP_CONTENT,&#10;                    LinearLayout.LayoutParams.WRAP_CONTENT&#10;            );&#10;            params.setMargins(8, 0, 8, 0);&#10;            indicators[i].setLayoutParams(params);&#10;&#10;            indicatorContainer.addView(indicators[i]);&#10;        }&#10;&#10;        if (indicators.length &gt; 0) {&#10;            indicators[0].setImageDrawable(getResources().getDrawable(R.drawable.indicator_active, null));&#10;        }&#10;    }&#10;&#10;    private void updateIndicators(int position) {&#10;        for (int i = 0; i &lt; indicatorContainer.getChildCount(); i++) {&#10;            ImageView indicator = (ImageView) indicatorContainer.getChildAt(i);&#10;            if (i == position) {&#10;                indicator.setImageDrawable(getResources().getDrawable(R.drawable.indicator_active, null));&#10;            } else {&#10;                indicator.setImageDrawable(getResources().getDrawable(R.drawable.indicator_inactive, null));&#10;            }&#10;        }&#10;    }&#10;&#10;    private void startAutoScroll() {&#10;        handler.postDelayed(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                if (vehicles.isEmpty()) return;&#10;&#10;                currentPage = (currentPage + 1) % vehicles.size();&#10;                vehicleImagePager.setCurrentItem(currentPage, true);&#10;&#10;                handler.postDelayed(this, 3000); // Auto scroll every 3 seconds&#10;            }&#10;        }, 3000);&#10;    }&#10;&#10;    private void logout() {&#10;        TokenHelper.clearTokensAsync(requireContext(), () -&gt; {&#10;            Intent intent = new Intent(requireContext(), MainActivity.class);&#10;            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);&#10;            startActivity(intent);&#10;            requireActivity().finish();&#10;        });&#10;    }&#10;&#10;    private void showError(String message) {&#10;        if (getContext() != null) {&#10;            Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onDestroyView() {&#10;        super.onDestroyView();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.animation.ObjectAnimator;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.os.Handler;&#10;import android.os.Looper;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.LinearLayout;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.viewpager2.widget.ViewPager2;&#10;&#10;import com.example.prm_assignment.MainActivity;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.ProfileResponse;&#10;import com.example.prm_assignment.data.model.VehicleModel;&#10;import com.example.prm_assignment.data.model.VehicleResponse;&#10;import com.example.prm_assignment.data.remote.VehiclesRetrofitClient;&#10;import com.example.prm_assignment.ui.adapters.VehicleImagePagerAdapter;&#10;import com.google.android.material.button.MaterialButton;&#10;import com.google.android.material.card.MaterialCardView;&#10;&#10;import java.text.ParseException;&#10;import java.text.SimpleDateFormat;&#10;import java.util.ArrayList;&#10;import java.util.Date;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class ProfileFragment extends Fragment {&#10;    private static final String TAG = &quot;ProfileFragment&quot;;&#10;&#10;    private ViewPager2 vehicleImagePager;&#10;    private LinearLayout indicatorContainer;&#10;    private MaterialCardView vehicleInfoCard;&#10;//    private ImageView vehicleAvatar;&#10;    private TextView tvVehicleNameProfile;&#10;    private TextView tvMileage;&#10;    private TextView tvLastServiceDate;&#10;    private TextView tvCustomerName;&#10;    private TextView tvEmail;&#10;    private TextView tvPhone;&#10;    private TextView tvAddress;&#10;    private LinearLayout phoneLayout;&#10;    private LinearLayout addressLayout;&#10;    private MaterialButton btnLogout;&#10;&#10;    private List&lt;VehicleModel&gt; vehicles = new ArrayList&lt;&gt;();&#10;    private VehicleImagePagerAdapter pagerAdapter;&#10;    private Handler handler = new Handler(Looper.getMainLooper());&#10;    private int currentPage = 0;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_profile, container, false);&#10;&#10;        initViews(view);&#10;        setupViewPager();&#10;        loadData();&#10;&#10;        return view;&#10;    }&#10;&#10;    private void initViews(View view) {&#10;        vehicleImagePager = view.findViewById(R.id.vehicleImagePager);&#10;        indicatorContainer = view.findViewById(R.id.indicatorContainer);&#10;        vehicleInfoCard = view.findViewById(R.id.vehicleInfoCard);&#10;//        vehicleAvatar = view.findViewById(R.id.vehicleAvatar);&#10;        tvVehicleNameProfile = view.findViewById(R.id.tvVehicleNameProfile);&#10;        tvMileage = view.findViewById(R.id.tvMileage);&#10;        tvLastServiceDate = view.findViewById(R.id.tvLastServiceDate);&#10;        tvCustomerName = view.findViewById(R.id.tvCustomerName);&#10;        tvEmail = view.findViewById(R.id.tvEmail);&#10;        tvPhone = view.findViewById(R.id.tvPhone);&#10;        tvAddress = view.findViewById(R.id.tvAddress);&#10;        phoneLayout = view.findViewById(R.id.phoneLayout);&#10;        addressLayout = view.findViewById(R.id.addressLayout);&#10;        btnLogout = view.findViewById(R.id.btnLogout);&#10;&#10;        btnLogout.setOnClickListener(v -&gt; logout());&#10;    }&#10;&#10;    private void setupViewPager() {&#10;        pagerAdapter = new VehicleImagePagerAdapter(vehicles, (vehicle, position) -&gt; {&#10;            // Handle image click if needed&#10;        });&#10;        vehicleImagePager.setAdapter(pagerAdapter);&#10;&#10;        vehicleImagePager.registerOnPageChangeCallback(new ViewPager2.OnPageChangeCallback() {&#10;            @Override&#10;            public void onPageSelected(int position) {&#10;                super.onPageSelected(position);&#10;                currentPage = position;&#10;                updateIndicators(position);&#10;                updateVehicleInfo(position);&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadData() {&#10;        loadProfile();&#10;        loadVehicles();&#10;    }&#10;&#10;    private void loadProfile() {&#10;        TokenHelper.loadProfileAsync(requireContext(), new TokenHelper.ProfileCallback() {&#10;            @Override&#10;            public void onSuccess(ProfileResponse response) {&#10;                if (response != null &amp;&amp; response.getData() != null) {&#10;                    updateProfileUI(response.getData());&#10;                } else {&#10;                    showError(&quot;Failed to load profile&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onError(String message) {&#10;                if (&quot;Token not found&quot;.equals(message)) {&#10;                    showError(&quot;Token not found. Please login again.&quot;);&#10;                    logout();&#10;                } else {&#10;                    showError(&quot;Error: &quot; + message);&#10;                    Log.e(TAG, &quot;Profile load error: &quot; + message);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadVehicles() {&#10;        TokenHelper.getAccessTokenAsync(requireContext(), token -&gt; {&#10;            if (token == null) return;&#10;&#10;            VehiclesRetrofitClient.getInstance().getVehiclesApi()&#10;                    .getMyVehicles(&quot;Bearer &quot; + token)&#10;                    .enqueue(new Callback&lt;VehicleResponse&gt;() {&#10;                        @Override&#10;                        public void onResponse(@NonNull Call&lt;VehicleResponse&gt; call, @NonNull Response&lt;VehicleResponse&gt; response) {&#10;                            if (response.isSuccessful() &amp;&amp; response.body() != null &amp;&amp; response.body().getData() != null) {&#10;                                vehicles.clear();&#10;                                vehicles.addAll(response.body().getData());&#10;                                pagerAdapter.updateVehicles(vehicles);&#10;&#10;                                if (!vehicles.isEmpty()) {&#10;                                    setupIndicators();&#10;                                    updateVehicleInfo(0);&#10;                                    startAutoScroll();&#10;                                }&#10;                            }&#10;                        }&#10;&#10;                        @Override&#10;                        public void onFailure(@NonNull Call&lt;VehicleResponse&gt; call, @NonNull Throwable t) {&#10;                            Log.e(TAG, &quot;Vehicles load error&quot;, t);&#10;                        }&#10;                    });&#10;        });&#10;    }&#10;&#10;    private void updateProfileUI(com.example.prm_assignment.data.model.ProfileResponse.ProfileData profile) {&#10;        if (profile == null) return;&#10;&#10;        tvCustomerName.setText(profile.getCustomerName() != null ? profile.getCustomerName() : &quot;N/A&quot;);&#10;        tvEmail.setText(profile.getUserId() != null &amp;&amp; profile.getUserId().getEmail() != null&#10;                ? profile.getUserId().getEmail() : &quot;N/A&quot;);&#10;&#10;        if (profile.getUserId() != null &amp;&amp; profile.getUserId().getPhone() != null &amp;&amp; !profile.getUserId().getPhone().isEmpty()) {&#10;            phoneLayout.setVisibility(View.VISIBLE);&#10;            tvPhone.setText(profile.getUserId().getPhone());&#10;        } else {&#10;            phoneLayout.setVisibility(View.GONE);&#10;        }&#10;&#10;        if (profile.getAddress() != null &amp;&amp; !profile.getAddress().isEmpty()) {&#10;            addressLayout.setVisibility(View.VISIBLE);&#10;            tvAddress.setText(profile.getAddress());&#10;        } else {&#10;            addressLayout.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    private void updateVehicleInfo(int position) {&#10;        if (vehicles.isEmpty() || position &gt;= vehicles.size()) return;&#10;&#10;        VehicleModel vehicle = vehicles.get(position);&#10;&#10;        // Fade out animation&#10;        ObjectAnimator fadeOut = ObjectAnimator.ofFloat(vehicleInfoCard, &quot;alpha&quot;, 1f, 0f);&#10;        fadeOut.setDuration(300);&#10;        fadeOut.start();&#10;&#10;        handler.postDelayed(() -&gt; {&#10;            // Update info&#10;            tvVehicleNameProfile.setText(vehicle.getVehicleName() != null ? vehicle.getVehicleName() : &quot;N/A&quot;);&#10;            tvMileage.setText(String.format(Locale.getDefault(), &quot;%.0f km&quot;, vehicle.getMileage()));&#10;&#10;            String lastServiceDate = vehicle.getLastServiceDate();&#10;            if (lastServiceDate != null &amp;&amp; !lastServiceDate.isEmpty()) {&#10;                tvLastServiceDate.setText(formatDate(lastServiceDate));&#10;            } else {&#10;                tvLastServiceDate.setText(&quot;Chưa bảo dưỡng&quot;);&#10;            }&#10;&#10;            // Fade in animation&#10;            ObjectAnimator fadeIn = ObjectAnimator.ofFloat(vehicleInfoCard, &quot;alpha&quot;, 0f, 1f);&#10;            fadeIn.setDuration(300);&#10;            fadeIn.start();&#10;        }, 300);&#10;    }&#10;&#10;    private String formatDate(String dateString) {&#10;        try {&#10;            SimpleDateFormat inputFormat = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;, Locale.getDefault());&#10;            SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;, Locale.getDefault());&#10;            Date date = inputFormat.parse(dateString);&#10;            return date != null ? outputFormat.format(date) : dateString;&#10;        } catch (ParseException e) {&#10;            return dateString;&#10;        }&#10;    }&#10;&#10;    private void setupIndicators() {&#10;        indicatorContainer.removeAllViews();&#10;        ImageView[] indicators = new ImageView[vehicles.size()];&#10;&#10;        for (int i = 0; i &lt; vehicles.size(); i++) {&#10;            indicators[i] = new ImageView(requireContext());&#10;            indicators[i].setImageDrawable(getResources().getDrawable(R.drawable.indicator_inactive, null));&#10;&#10;            LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(&#10;                    LinearLayout.LayoutParams.WRAP_CONTENT,&#10;                    LinearLayout.LayoutParams.WRAP_CONTENT&#10;            );&#10;            params.setMargins(8, 0, 8, 0);&#10;            indicators[i].setLayoutParams(params);&#10;&#10;            indicatorContainer.addView(indicators[i]);&#10;        }&#10;&#10;        if (indicators.length &gt; 0) {&#10;            indicators[0].setImageDrawable(getResources().getDrawable(R.drawable.indicator_active, null));&#10;        }&#10;    }&#10;&#10;    private void updateIndicators(int position) {&#10;        for (int i = 0; i &lt; indicatorContainer.getChildCount(); i++) {&#10;            ImageView indicator = (ImageView) indicatorContainer.getChildAt(i);&#10;            if (i == position) {&#10;                indicator.setImageDrawable(getResources().getDrawable(R.drawable.indicator_active, null));&#10;            } else {&#10;                indicator.setImageDrawable(getResources().getDrawable(R.drawable.indicator_inactive, null));&#10;            }&#10;        }&#10;    }&#10;&#10;    private void startAutoScroll() {&#10;        handler.postDelayed(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                if (vehicles.isEmpty()) return;&#10;&#10;                currentPage = (currentPage + 1) % vehicles.size();&#10;                vehicleImagePager.setCurrentItem(currentPage, true);&#10;&#10;                handler.postDelayed(this, 3000); // Auto scroll every 3 seconds&#10;            }&#10;        }, 3000);&#10;    }&#10;&#10;    private void logout() {&#10;        TokenHelper.clearTokensAsync(requireContext(), () -&gt; {&#10;            Intent intent = new Intent(requireContext(), MainActivity.class);&#10;            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);&#10;            startActivity(intent);&#10;            requireActivity().finish();&#10;        });&#10;    }&#10;&#10;    private void showError(String message) {&#10;        if (getContext() != null) {&#10;            Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onDestroyView() {&#10;        super.onDestroyView();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/VehiclesFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_assignment/ui/fragments/VehiclesFragment.java" />
              <option name="originalContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.ui.adapters.VehicleAdapter;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.VehicleModel;&#10;import com.example.prm_assignment.data.model.VehicleResponse;&#10;import com.example.prm_assignment.data.remote.VehiclesApi;&#10;import com.example.prm_assignment.data.remote.VehiclesRetrofitClient;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class VehiclesFragment extends Fragment implements VehicleAdapter.OnVehicleClickListener {&#10;&#10;    private static final String TAG = &quot;VehiclesFragment&quot;;&#10;&#10;    private RecyclerView vehiclesRecyclerView;&#10;    private VehicleAdapter vehicleAdapter;&#10;    private VehiclesApi vehiclesApi;&#10;    private TokenHelper tokenHelper;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_vehicles, container, false);&#10;&#10;        // Initialize RecyclerView&#10;        vehiclesRecyclerView = view.findViewById(R.id.vehiclesRecyclerView);&#10;        vehiclesRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));&#10;&#10;        // Initialize API client&#10;        vehiclesApi = VehiclesRetrofitClient.getInstance().getVehiclesApi();&#10;        tokenHelper = new TokenHelper(requireContext());&#10;&#10;        // Initialize adapter with empty list&#10;        vehicleAdapter = new VehicleAdapter(new ArrayList&lt;&gt;(), this);&#10;        vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;&#10;        // Fetch vehicles from API&#10;        fetchMyVehicles();&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void onVehicleClick(VehicleAdapter.Vehicle vehicle) {&#10;        // Handle vehicle click - navigate to detail fragment&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            VehicleDetailFragment detailFragment = VehicleDetailFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, detailFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBookServiceClick(VehicleAdapter.Vehicle vehicle) {&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            BookingFragment bookingFragment = BookingFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, bookingFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;&#10;    private void fetchMyVehicles() {&#10;        // Use TokenHelper to get token asynchronously&#10;        tokenHelper.getTokenAndExecute(new TokenHelper.TokenCallback() {&#10;            @Override&#10;            public void onTokenRetrieved(String token) {&#10;                if (token != null &amp;&amp; !token.isEmpty()) {&#10;                    makeApiCall(&quot;Bearer &quot; + token);&#10;                } else {&#10;                    showError(&quot;Please login first&quot;);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void makeApiCall(String authToken) {&#10;        vehiclesApi.getMyVehicles(authToken).enqueue(new Callback&lt;VehicleResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;VehicleResponse&gt; call, Response&lt;VehicleResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    VehicleResponse vehicleResponse = response.body();&#10;                    if (vehicleResponse.isSuccess() &amp;&amp; vehicleResponse.getData() != null) {&#10;                        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = convertToAdapterVehicles(vehicleResponse.getData());&#10;                        updateRecyclerView(vehicleList);&#10;                    } else {&#10;                        showError(&quot;No vehicles found&quot;);&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to fetch vehicles: &quot; + response.code());&#10;                    Log.e(TAG, &quot;Error response: &quot; + response.code() + &quot; - &quot; + response.message());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;VehicleResponse&gt; call, Throwable t) {&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;            }&#10;        });&#10;    }&#10;&#10;    private List&lt;VehicleAdapter.Vehicle&gt; convertToAdapterVehicles(List&lt;VehicleModel&gt; vehicleModels) {&#10;        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = new ArrayList&lt;&gt;();&#10;        NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(new Locale(&quot;vi&quot;, &quot;VN&quot;));&#10;&#10;        for (VehicleModel model : vehicleModels) {&#10;            String id = model.getId();&#10;            String vehicleName = model.getVehicleName() != null ? model.getVehicleName() : model.getModel();&#10;            String year = String.valueOf(model.getYear());&#10;            String vin = model.getVin();&#10;            String mileage = String.format(Locale.getDefault(), &quot;%.0f km&quot;, model.getMileage());&#10;            String price = currencyFormat.format(model.getPrice());&#10;            String owner = model.getCustomerId() != null ? model.getCustomerId().getCustomerName() : &quot;Unknown&quot;;&#10;            String address = model.getCustomerId() != null ? model.getCustomerId().getAddress() : &quot;Unknown&quot;;&#10;            String imageUrl = model.getImage(); // Get image URL from API&#10;&#10;            vehicleList.add(new VehicleAdapter.Vehicle(&#10;                    id,&#10;                    vehicleName,&#10;                    year,&#10;                    vin,&#10;                    mileage,&#10;                    price,&#10;                    owner,&#10;                    address,&#10;                    imageUrl  // Use imageUrl instead of imageResId&#10;            ));&#10;        }&#10;&#10;        return vehicleList;&#10;    }&#10;&#10;    private void updateRecyclerView(List&lt;VehicleAdapter.Vehicle&gt; vehicleList) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                vehicleAdapter = new VehicleAdapter(vehicleList, this);&#10;                vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;            });&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;            });&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_assignment.ui.fragments;&#10;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.prm_assignment.R;&#10;import com.example.prm_assignment.ui.adapters.VehicleAdapter;&#10;import com.example.prm_assignment.data.TokenHelper;&#10;import com.example.prm_assignment.data.model.VehicleModel;&#10;import com.example.prm_assignment.data.model.VehicleResponse;&#10;import com.example.prm_assignment.data.remote.VehiclesApi;&#10;import com.example.prm_assignment.data.remote.VehiclesRetrofitClient;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class VehiclesFragment extends Fragment implements VehicleAdapter.OnVehicleClickListener {&#10;&#10;    private static final String TAG = &quot;VehiclesFragment&quot;;&#10;&#10;    private RecyclerView vehiclesRecyclerView;&#10;    private VehicleAdapter vehicleAdapter;&#10;    private VehiclesApi vehiclesApi;&#10;    private TokenHelper tokenHelper;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_vehicles, container, false);&#10;&#10;        // Initialize RecyclerView&#10;        vehiclesRecyclerView = view.findViewById(R.id.vehiclesRecyclerView);&#10;        vehiclesRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));&#10;&#10;        // Initialize API client&#10;        vehiclesApi = VehiclesRetrofitClient.getInstance().getVehiclesApi();&#10;        tokenHelper = new TokenHelper(requireContext());&#10;&#10;        // Initialize adapter with empty list&#10;        vehicleAdapter = new VehicleAdapter(new ArrayList&lt;&gt;(), this);&#10;        vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;&#10;        // Fetch vehicles from API&#10;        fetchMyVehicles();&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void onVehicleClick(VehicleAdapter.Vehicle vehicle) {&#10;        // Handle vehicle click - navigate to detail fragment&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            VehicleDetailFragment detailFragment = VehicleDetailFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, detailFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBookServiceClick(VehicleAdapter.Vehicle vehicle) {&#10;        if (vehicle.id != null &amp;&amp; !vehicle.id.isEmpty()) {&#10;            BookingFragment bookingFragment = BookingFragment.newInstance(vehicle.id);&#10;&#10;            if (getActivity() != null) {&#10;                getActivity().getSupportFragmentManager()&#10;                        .beginTransaction()&#10;                        .replace(R.id.fragment_container, bookingFragment)&#10;                        .addToBackStack(null)&#10;                        .commit();&#10;            }&#10;        } else {&#10;            Toast.makeText(getContext(), &quot;Invalid vehicle ID&quot;, Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;&#10;    private void fetchMyVehicles() {&#10;        // Use TokenHelper to get token asynchronously&#10;        tokenHelper.getTokenAndExecute(new TokenHelper.TokenCallback() {&#10;            @Override&#10;            public void onTokenRetrieved(String token) {&#10;                if (token != null &amp;&amp; !token.isEmpty()) {&#10;                    makeApiCall(&quot;Bearer &quot; + token);&#10;                } else {&#10;                    showError(&quot;Please login first&quot;);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void makeApiCall(String authToken) {&#10;        vehiclesApi.getMyVehicles(authToken).enqueue(new Callback&lt;VehicleResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;VehicleResponse&gt; call, Response&lt;VehicleResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    VehicleResponse vehicleResponse = response.body();&#10;                    if (vehicleResponse.isSuccess() &amp;&amp; vehicleResponse.getData() != null) {&#10;                        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = convertToAdapterVehicles(vehicleResponse.getData());&#10;                        updateRecyclerView(vehicleList);&#10;                    } else {&#10;                        showError(&quot;No vehicles found&quot;);&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to fetch vehicles: &quot; + response.code());&#10;                    Log.e(TAG, &quot;Error response: &quot; + response.code() + &quot; - &quot; + response.message());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;VehicleResponse&gt; call, Throwable t) {&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;            }&#10;        });&#10;    }&#10;&#10;    private List&lt;VehicleAdapter.Vehicle&gt; convertToAdapterVehicles(List&lt;VehicleModel&gt; vehicleModels) {&#10;        List&lt;VehicleAdapter.Vehicle&gt; vehicleList = new ArrayList&lt;&gt;();&#10;        NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(new Locale(&quot;vi&quot;, &quot;VN&quot;));&#10;&#10;        for (VehicleModel model : vehicleModels) {&#10;            String id = model.getId();&#10;            String vehicleName = model.getVehicleName() != null ? model.getVehicleName() : model.getModel();&#10;            String year = String.valueOf(model.getYear());&#10;            String vin = model.getVin();&#10;            String mileage = String.format(Locale.getDefault(), &quot;%.0f km&quot;, model.getMileage());&#10;            String price = currencyFormat.format(model.getPrice());&#10;            String owner = model.getCustomerId() != null ? model.getCustomerId().getCustomerName() : &quot;Unknown&quot;;&#10;            String address = model.getCustomerId() != null ? model.getCustomerId().getAddress() : &quot;Unknown&quot;;&#10;            String imageUrl = model.getImage(); // Get image URL from API&#10;&#10;            vehicleList.add(new VehicleAdapter.Vehicle(&#10;                    id,&#10;                    vehicleName,&#10;                    year,&#10;                    vin,&#10;                    mileage,&#10;                    price,&#10;                    owner,&#10;                    address,&#10;                    imageUrl  // Use imageUrl instead of imageResId&#10;            ));&#10;        }&#10;&#10;        return vehicleList;&#10;    }&#10;&#10;    private void updateRecyclerView(List&lt;VehicleAdapter.Vehicle&gt; vehicleList) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                vehicleAdapter = new VehicleAdapter(vehicleList, this);&#10;                vehiclesRecyclerView.setAdapter(vehicleAdapter);&#10;            });&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;            });&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>